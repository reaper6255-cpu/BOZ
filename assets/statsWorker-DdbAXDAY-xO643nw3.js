(function(){"use strict";const yt=["selfBuffs","groupBuffs","squadBuffs"],en=n=>n!=null&&n.classification?n.classification==="Boon":!0,tn=n=>`b${n}`,jn=(n,m)=>{const N=Array.isArray(n==null?void 0:n.activeTimes)?n.activeTimes:[],z=typeof N[0]=="number"?N[0]:0;return z>0?z:m},nn=(n,m,N,z,Y,$,pe)=>{const y=n==="selfBuffs"?1:Math.max(n==="groupBuffs"?$-1:pe-1,0);return!y||!Y?{generationMs:0,wastedMs:0}:m?{generationMs:N*Y*y,wastedMs:z*Y*y}:{generationMs:N/100*Y*y,wastedMs:z/100*Y*y}},Wn=n=>{const m=new Map,N=new Map;return n.forEach($=>{const pe=$.details;if(!pe)return;const y=pe.durationMS||0,ce=pe.buffMap||{};Object.entries(ce).forEach(([Q,se])=>{if(!m.has(Q)){m.set(Q,se);return}const de=m.get(Q)||{},re={name:de.name||se.name,stacking:de.stacking??se.stacking,icon:de.icon||se.icon,classification:de.classification||se.classification};m.set(Q,re)});const Ve=(pe.players||[]).filter(Q=>!Q.notInSquad),We=Ve.length,_e=new Map;Ve.forEach(Q=>{const se=Q.group??0;_e.set(se,(_e.get(se)||0)+1)}),Ve.forEach(Q=>{const se=Q.account||Q.name||Q.character_name||"Unknown",de=Q.profession||"Unknown",re=Q.group??0,Ae=_e.get(re)||1,Be=jn(Q,y);N.has(se)||N.set(se,{account:se,profession:de,professions:new Set,professionTimeMs:{},activeTimeMs:0,numFights:0,groupSupported:0,squadSupported:0,boons:{}});const ie=N.get(se);ie.profession=de,de!=="Unknown"&&(ie.professions.add(de),ie.professionTimeMs[de]=(ie.professionTimeMs[de]||0)+Be),ie.activeTimeMs+=Be,ie.numFights+=1,ie.groupSupported+=Ae,ie.squadSupported+=We,yt.forEach(Ne=>{(Q[Ne]||[]).forEach(D=>{var Ce,He,ze,Ge;if(typeof(D==null?void 0:D.id)!="number")return;const ue=tn(D.id),fe=ce[ue];if(!en(fe))return;const Se=(fe==null?void 0:fe.stacking)??!1,De=((He=(Ce=D.buffData)==null?void 0:Ce[0])==null?void 0:He.generation)??0,me=((Ge=(ze=D.buffData)==null?void 0:ze[0])==null?void 0:Ge.wasted)??0,{generationMs:qe,wastedMs:ge}=nn(Ne,Se,De,me,y,Ae,We);!qe&&!ge||(m.has(ue)||m.set(ue,fe||{}),ie.boons[ue]||(ie.boons[ue]={selfBuffs:{generationMs:0,wastedMs:0},groupBuffs:{generationMs:0,wastedMs:0},squadBuffs:{generationMs:0,wastedMs:0}}),ie.boons[ue][Ne].generationMs+=qe,ie.boons[ue][Ne].wastedMs+=ge)})})})}),{boonTables:Array.from(m.keys()).filter($=>en(m.get($))).map($=>{const pe=m.get($)||{},y=[];return N.forEach(ce=>{var Q;const he=ce.boons[$];if(!he||!yt.some(se=>he[se].generationMs>0||he[se].wastedMs>0))return;const We=Array.from(ce.professions||[]).filter(se=>se&&se!=="Unknown");let _e=ce.profession;if(We.length>0){_e=We[0];let se=((Q=ce.professionTimeMs)==null?void 0:Q[_e])||0;We.forEach(de=>{var Ae;const re=((Ae=ce.professionTimeMs)==null?void 0:Ae[de])||0;re>se&&(se=re,_e=de)})}y.push({account:ce.account,profession:_e||"Unknown",professionList:We,activeTimeMs:ce.activeTimeMs||1,numFights:ce.numFights||1,groupSupported:ce.groupSupported||1,squadSupported:ce.squadSupported||1,categories:{selfBuffs:{...he.selfBuffs},groupBuffs:{...he.groupBuffs},squadBuffs:{...he.squadBuffs}}})}),{id:$,name:pe.name||$,icon:pe.icon,stacking:pe.stacking??!1,rows:y}}).filter($=>$.rows.length>0)}},Ot=(n,m,N,z,Y,$,pe={})=>{var Q,se,de,re;const ce=((n==null?void 0:n[m])||[]).find(Ae=>Ae.id===N);if(!ce)return{generationMs:0,wastedMs:0};const he=pe[tn(N)],Ve=(he==null?void 0:he.stacking)??!1,We=((se=(Q=ce.buffData)==null?void 0:Q[0])==null?void 0:se.generation)??0,_e=((re=(de=ce.buffData)==null?void 0:de[0])==null?void 0:re.wasted)??0;return nn(m,Ve,We,_e,z,Y,$)};var zn={methods:{tiered:{tiers:{shortMs:500,mediumMs:1500,weights:{short:.5,medium:1,long:2}}}}};const Vn=zn,Ht="count",Kn=n=>(n||0)/1e3,Gn=(n,m)=>{var Y;if(!n)return 0;const N=(Y=Vn.methods.tiered)==null?void 0:Y.tiers;if(!N)return n;const z=m/Math.max(n,1);return z<=N.shortMs?n*N.weights.short:z<=N.mediumMs?n*N.weights.medium:n*N.weights.long},sn=(n,m,N)=>N==="duration"?Kn(m):N==="tiered"?Gn(n,m):n;function Jn(n,m=Ht){var $;const N=($=n.statsAll)==null?void 0:$[0],z=Number((N==null?void 0:N.appliedCrowdControl)??0),Y=Number((N==null?void 0:N.appliedCrowdControlDuration)??0);return sn(z,Y,m)}function Yn(n,m){const N=(m==null?void 0:m.durationMS)||0,z=(m==null?void 0:m.buffMap)||{},Y=n.filter(y=>!y.notInSquad),$=Y.length,pe=new Map;Y.forEach(y=>{const ce=y.group??0;pe.set(ce,(pe.get(ce)||0)+1)}),Y.forEach(y=>{const ce=pe.get(y.group??0)||1,he=Ot(y,"selfBuffs",1122,N,ce,$,z),Ve=Ot(y,"squadBuffs",1122,N,ce,$,z);y.stabGeneration=(he.generationMs+Ve.generationMs)/1e3})}function Qn(n){if(!n.statsTargets)return 0;let m=0;for(const N of n.statsTargets)N&&N.length>0&&(m+=N[0].downContribution||0);return m}function Xn(n){if(!n.extBarrierStats||!n.extBarrierStats.outgoingBarrierAllies)return 0;let m=0;for(const N of n.extBarrierStats.outgoingBarrierAllies)if(N)for(const z of N)z&&(m+=z.barrier||0);return m}function Zn(n){if(!n.extHealingStats||!n.extHealingStats.outgoingHealingAllies)return 0;let m=0;for(const N of n.extHealingStats.outgoingHealingAllies)if(N)for(const z of N)z&&(m+=z.healing||0);return m}const on=n=>{var m,N,z,Y;return(((N=(m=n.support)==null?void 0:m[0])==null?void 0:N.condiCleanse)||0)+(((Y=(z=n.support)==null?void 0:z[0])==null?void 0:Y.condiCleanseSelf)||0)},an=(n,m=Ht)=>{var $;const N=($=n.support)==null?void 0:$[0],z=Number((N==null?void 0:N.boonStrips)??0),Y=Number((N==null?void 0:N.boonStripsTime)??0);return sn(z,Y,m)},rn=n=>Qn(n),cn=n=>Zn(n),un=n=>Xn(n),mn=(n,m=Ht)=>Jn(n,m),yn=(n,m)=>Yn(n,m),es="count",ts={downContribution:1,healing:1,cleanses:1,strips:1,stability:1,cc:.7,revives:.7,distanceToTag:.7,participation:.7,dodging:.4,dps:.2,damage:.2},ns={showMvp:!0,topSkillDamageSource:"target",topSkillsMetric:"damage"},ln=new Map([["bleeding","Bleeding"],["burning","Burning"],["confusion","Confusion"],["poison","Poison"],["torment","Torment"],["vulnerability","Vulnerability"],["weakness","Weakness"],["weakened","Weakness"],["blind","Blind"],["blinded","Blind"],["blinding","Blind"],["cripple","Cripple"],["crippled","Cripple"],["chill","Chill"],["chilled","Chill"],["immob","Immobilize"],["immobile","Immobilize"],["immobilized","Immobilize"],["slow","Slow"],["slowed","Slow"],["fear","Fear"],["feared","Fear"],["taunt","Taunt"],["taunted","Taunt"]]),ss={Blind:"https://render.guildwars2.com/file/09770136BB76FD0DBE1CC4267DEED54774CB20F6/102837.png",Chill:"https://render.guildwars2.com/file/28C4EC547A3516AF0242E826772DA43A5EAC3DF3/102839.png",Cripple:"https://render.guildwars2.com/file/070325E519C178D502A8160523766070D30C0C19/102838.png",Fear:"https://render.guildwars2.com/file/30307A6E766D74B6EB09EDA12A4A2DE50E4D76F4/102869.png",Immobilize:"https://render.guildwars2.com/file/397A613651BFCA2832B6469CE34735580A2C120E/102844.png",Slow:"https://render.guildwars2.com/file/F60D1EF5271D7B9319610855676D320CD25F01C6/961397.png",Taunt:"https://render.guildwars2.com/file/02EED459AD65FAF7DF32A260E479C625070841B9/1228472.png",Vulnerability:"https://render.guildwars2.com/file/3A394C1A0A3257EB27A44842DDEEF0DF000E1241/102850.png",Weakness:"https://render.guildwars2.com/file/6CB0E64AF9AA292E332A38C1770CE577E2CDE0E8/102853.png"},lt=(n,m)=>{if(!n||m===void 0||m===null)return;const N=Number(m);return Number.isFinite(N)?n[`b${N}`]||n[String(N)]:n[String(m)]},ht=n=>{if(!n)return null;const m=n.trim().toLowerCase(),N=ln.get(m);if(N)return N;const z=m.split(/[^a-z]+/).filter(Boolean);for(const Y of z){const $=ln.get(Y);if($)return $}return null},is=n=>ht(n),fn=n=>{const m=new Map;return n&&(Object.values(n).forEach(N=>{if(!(N!=null&&N.icon)||!(N!=null&&N.name))return;const z=ht(N.name);z&&(m.has(z)||m.set(z,N.icon))}),Object.entries(ss).forEach(([N,z])=>{m.has(N)||m.set(N,z)})),m},Tt=(n,m,N)=>{var z;if(m&&N){const Y=(z=lt(N,m))==null?void 0:z.name,$=ht(Y);if($)return $}return n?ht(n):null},os=n=>{const m=(n==null?void 0:n.account)||"Unknown";return m&&m!=="Unknown"?m:(n==null?void 0:n.name)||"Unknown"||null},as=n=>{if(!n||n.length===0)return 0;let m=0,N=null;return n.forEach(z=>{const Y=Number(z[1]??0);if(Number.isFinite(Y)){if(N===null){N=Y;return}Y>N&&(m+=Y-N),N=Y}}),m},rs=n=>{if(!n||n.length===0)return 0;let m=0;return n.forEach(N=>{const z=Number(N[0]??0),Y=Number(N[1]??0);Number.isFinite(Y)&&z!==0&&Y>0&&(m+=1)}),m},cs=n=>{const{players:m,targets:N,skillMap:z,buffMap:Y}=n,$=n.getPlayerKey||os,pe=fn(Y),y={},ce={};m.forEach(Q=>{if(Q!=null&&Q.notInSquad)return;const se=$(Q);se&&(y[se]||(y[se]={}),Q!=null&&Q.totalDamageDist&&Q.totalDamageDist.forEach(de=>{de&&de.forEach(re=>{if(!re.id)return;let Ae=`Skill ${re.id}`,Be;z&&(z[`s${re.id}`]?(Ae=z[`s${re.id}`].name||Ae,Be=z[`s${re.id}`].icon||Be):z[`${re.id}`]&&(Ae=z[`${re.id}`].name||Ae,Be=z[`${re.id}`].icon||Be));const ie=lt(Y,re.id);Ae.startsWith("Skill ")&&(ie!=null&&ie.name)&&(Ae=ie.name,Be=ie.icon||Be);const Ne=Tt(Ae,re.id,Y);if(!Ne)return;const Qe=ie==null?void 0:ie.name,D=pe.get(Ne)||(ie==null?void 0:ie.icon),ue=Ae.startsWith("Skill ")?Qe||Ne:Ae,fe=Be||(ie==null?void 0:ie.icon),Se=Number(re.connectedHits??0),De=Number(re.hits??0),me=Se>0?Se:De,qe=Number(re.totalDamage??0);if(!Number.isFinite(me)&&!Number.isFinite(qe))return;const ge=ce[Ne]||{name:Ne,icon:D,applications:0,damage:0};ge.applications+=Number.isFinite(me)?me:0,ge.damage+=Number.isFinite(qe)?qe:0,!ge.icon&&D&&(ge.icon=D),ce[Ne]=ge;const Ce=y[se][Ne]||{icon:D,applications:0,damage:0,skills:{}};Ce.applications+=Number.isFinite(me)?me:0,Ce.damage+=Number.isFinite(qe)?qe:0;const He=Ce.skills[ue]||{name:ue,hits:0,damage:0,icon:fe};He.hits+=Number.isFinite(me)?me:0,He.damage+=Number.isFinite(qe)?qe:0,!He.icon&&fe&&(He.icon=fe),Ce.skills[ue]=He,!Ce.icon&&D&&(Ce.icon=D),y[se][Ne]=Ce})}))});const he=new Map;m.forEach(Q=>{if(Q!=null&&Q.notInSquad)return;const se=$(Q);se&&Q!=null&&Q.name&&he.set(Q.name,se)});let Ve=0,We=0,_e=0;return N.forEach(Q=>{Q!=null&&Q.buffs&&Q.buffs.forEach(se=>{const de=Number(se==null?void 0:se.id);if(!Number.isFinite(de))return;const re=lt(Y,de),Ae=ht(re==null?void 0:re.name);if(!Ae||re!=null&&re.classification&&re.classification!=="Condition")return;const Be=Ae;if(!Be)return;const ie=se.statesPerSource||{};_e+=1,Object.entries(ie).forEach(([Ne,Qe])=>{var me;const D=he.get(Ne);if(!D)return;We+=1;const ue=as(Qe),fe=rs(Qe);Ve+=ue;const Se=((me=y[D])==null?void 0:me[Be])||{applications:0,damage:0,skills:{}};Se.applicationsFromBuffs=(Se.applicationsFromBuffs||0)+ue,Se.applicationsFromBuffsActive=(Se.applicationsFromBuffsActive||0)+fe,y[D]=y[D]||{},y[D][Be]=Se;const De=ce[Be]||{name:Be,applications:0,damage:0};De.applicationsFromBuffs=(De.applicationsFromBuffs||0)+ue,De.applicationsFromBuffsActive=(De.applicationsFromBuffsActive||0)+fe,ce[Be]=De})})}),Object.values(y).forEach(Q=>{Object.values(Q).forEach(se=>{typeof se.applicationsFromBuffs=="number"&&(se.applications=se.applicationsFromBuffs)})}),Object.values(ce).forEach(Q=>{typeof Q.applicationsFromBuffs=="number"&&(Q.applications=Q.applicationsFromBuffs)}),{playerConditions:y,summary:ce,meta:{buffStateApplicationsTotal:Ve,targetBuffEntriesSeen:_e,buffStateSourcesSeen:We}}},us=new Set(["Vulnerability","Weakness","Blind","Cripple","Chill","Immobilize","Slow","Fear","Taunt"]),ms=[{id:"damage",label:"Damage",field:"damage",source:"dpsAll"},{id:"directDmg",label:"Direct Damage",field:"directDmg",source:"statsTargets"},{id:"connectedDamageCount",label:"Connected Damage Count",field:"connectedDamageCount",source:"statsTargets"},{id:"connectedDirectDamageCount",label:"Connected Direct Damage Count",field:"connectedDirectDamageCount",source:"statsTargets"},{id:"battleStandardHits",label:"Battle Standard Tracking"},{id:"criticalRate",label:"Critical Rate",field:"criticalRate",isRate:!0,isPercent:!0,denomField:"critableDirectDamageCount",source:"statsTargets"},{id:"criticalDmg",label:"Critical Damage",field:"criticalDmg",source:"statsTargets"},{id:"flankingRate",label:"Flanking Rate",field:"flankingRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"glanceRate",label:"Glance Rate",field:"glanceRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"missed",label:"Missed",field:"missed",source:"statsTargets"},{id:"evaded",label:"Evaded (enemy)",field:"evaded",source:"statsTargets"},{id:"blocked",label:"Blocked (enemy)",field:"blocked",source:"statsTargets"},{id:"interrupts",label:"Interrupts",field:"interrupts",source:"statsTargets"},{id:"invulned",label:"Invulned",field:"invulned",source:"statsTargets"},{id:"killed",label:"Killed",field:"killed",source:"statsTargets"},{id:"downed",label:"Downed",field:"downed",source:"statsTargets"},{id:"downContribution",label:"Down Contribution",field:"downContribution",source:"statsTargets"},{id:"downContributionPercent",label:"Down Contribution %",isRate:!0,isPercent:!0},{id:"againstDownedDamage",label:"Against Downed Damage",field:"againstDownedDamage",source:"statsTargets"},{id:"appliedCrowdControl",label:"Applied CC",field:"appliedCrowdControl",source:"statsTargets"},{id:"appliedCrowdControlDuration",label:"Applied CC Duration",field:"appliedCrowdControlDuration",source:"statsTargets"},{id:"appliedCrowdControlDownContribution",label:"Applied CC Down Contribution",field:"appliedCrowdControlDownContribution",source:"statsTargets"},{id:"appliedCrowdControlDurationDownContribution",label:"Applied CC Duration Down Contribution",field:"appliedCrowdControlDurationDownContribution",source:"statsTargets"},{id:"boonStrips",label:"Boon Strips",field:"boonStrips",source:"support"}],ls=[{id:"damageTaken",label:"Damage Taken",field:"damageTaken"},{id:"minionDamageTaken",label:"Minion Damage Taken"},{id:"damageTakenCount",label:"Damage Taken Count",field:"damageTakenCount"},{id:"conditionDamageTaken",label:"Condition Damage Taken",field:"conditionDamageTaken"},{id:"conditionDamageTakenCount",label:"Condition Damage Taken Count",field:"conditionDamageTakenCount"},{id:"powerDamageTaken",label:"Power Damage Taken",field:"powerDamageTaken"},{id:"powerDamageTakenCount",label:"Power Damage Taken Count",field:"powerDamageTakenCount"},{id:"downedDamageTaken",label:"Downed Damage Taken",field:"downedDamageTaken"},{id:"downedDamageTakenCount",label:"Downed Damage Taken Count",field:"downedDamageTakenCount"},{id:"damageBarrier",label:"Damage Barrier",field:"damageBarrier"},{id:"damageBarrierCount",label:"Damage Barrier Count",field:"damageBarrierCount"},{id:"blockedCount",label:"Blocked Count",field:"blockedCount"},{id:"evadedCount",label:"Evaded Count",field:"evadedCount"},{id:"missedCount",label:"Missed Count",field:"missedCount"},{id:"dodgeCount",label:"Dodge Count",field:"dodgeCount"},{id:"invulnedCount",label:"Invulnerable Count",field:"invulnedCount"},{id:"interruptedCount",label:"Interrupted Count",field:"interruptedCount"},{id:"downCount",label:"Down Count",field:"downCount"},{id:"deadCount",label:"Death Count",field:"deadCount"},{id:"boonStrips",label:"Boon Strips (Incoming)",field:"boonStrips"},{id:"conditionCleanses",label:"Cleanses (Incoming)",field:"conditionCleanses"},{id:"receivedCrowdControl",label:"Crowd Control (Incoming)",field:"receivedCrowdControl"}],fs=[{id:"condiCleanse",label:"Condition Cleanses",field:"condiCleanse"},{id:"condiCleanseTime",label:"Condition Cleanse Time",field:"condiCleanseTime",isTime:!0},{id:"condiCleanseSelf",label:"Condition Cleanse Self",field:"condiCleanseSelf"},{id:"condiCleanseTimeSelf",label:"Condition Cleanse Time Self",field:"condiCleanseTimeSelf",isTime:!0},{id:"boonStrips",label:"Boon Strips",field:"boonStrips"},{id:"boonStripsTime",label:"Boon Strips Time",field:"boonStripsTime",isTime:!0},{id:"boonStripDownContribution",label:"Boon Strip Down Contribution",field:"boonStripDownContribution"},{id:"boonStripDownContributionTime",label:"Boon Strip Down Contribution Time",field:"boonStripDownContributionTime",isTime:!0},{id:"stunBreak",label:"Stun Breaks",field:"stunBreak"},{id:"removedStunDuration",label:"Removed Stun Duration",field:"removedStunDuration",isTime:!0},{id:"resurrects",label:"Resurrects",field:"resurrects"},{id:"resurrectTime",label:"Resurrect Time",field:"resurrectTime",isTime:!0}],ds=["battle standard","glyph of renewal","glyph of the stars","illusion of life","spirit of nature","nature spirit","search and rescue","signet of mercy"],gs=new Set([10244]),bs=(n,m)=>{var Y;if(gs.has(n))return!0;const N=(m==null?void 0:m[`s${n}`])||(m==null?void 0:m[`${n}`]),z=((Y=N==null?void 0:N.name)==null?void 0:Y.toLowerCase())||"";return ds.some($=>z.includes($))},Ft=n=>{if(!n||!Number.isFinite(n))return"--:--";const m=Math.max(0,Math.round(n/1e3)),N=Math.floor(m/3600),z=Math.floor(m%3600/60),Y=m%60;return N>0?`${N}:${String(z).padStart(2,"0")}:${String(Y).padStart(2,"0")}`:`${z}:${String(Y).padStart(2,"0")}`},Bt={Guardian:"#72C1D9",Dragonhunter:"#72C1D9",Firebrand:"#72C1D9",Willbender:"#72C1D9",Revenant:"#D16E5A",Herald:"#D16E5A",Renegade:"#D16E5A",Vindicator:"#D16E5A",Warrior:"#FFD166",Berserker:"#FFD166",Spellbreaker:"#FFD166",Bladesworn:"#FFD166",Engineer:"#D09C59",Scrapper:"#D09C59",Holosmith:"#D09C59",Mechanist:"#D09C59",Ranger:"#8CDC82",Druid:"#8CDC82",Soulbeast:"#8CDC82",Untamed:"#8CDC82",Thief:"#C08F95",Daredevil:"#C08F95",Deadeye:"#C08F95",Specter:"#C08F95",Elementalist:"#F68A87",Tempest:"#F68A87",Weaver:"#F68A87",Catalyst:"#F68A87",Mesmer:"#B679D5",Chronomancer:"#B679D5",Mirage:"#B679D5",Virtuoso:"#B679D5",Necromancer:"#52A76F",Reaper:"#52A76F",Scourge:"#52A76F",Harbinger:"#52A76F",Ritualist:"#52A76F",Luminary:"#72C1D9",Conduit:"#D16E5A",Paragon:"#FFD166",Amalgam:"#D09C59",Galeshot:"#8CDC82",Antiquary:"#C08F95",Evoker:"#F68A87",Troubadour:"#B679D5",Unknown:"#64748B"};function dn(n){return Bt[n]||Bt.Unknown}const ps=n=>{if(n==null||n==="")return 0;if(typeof n=="number")return!Number.isFinite(n)||n<=0?0:n>1e12?n:n*1e3;if(n instanceof Date){const pe=n.getTime();return Number.isFinite(pe)&&pe>0?pe:0}const m=String(n).trim();if(!m)return 0;const N=Number(m);if(Number.isFinite(N)&&N>0)return N>1e12?N:N*1e3;const z=Date.parse(m);if(Number.isFinite(z)&&z>0)return z;const Y=m.replace(/([+-]\d{2})$/,"$1:00"),$=Date.parse(Y);return Number.isFinite($)&&$>0?$:0},Oe=(n,m)=>ps((n==null?void 0:n.timeStartStd)??(n==null?void 0:n.timeStart)??(n==null?void 0:n.timeEndStd)??(n==null?void 0:n.timeEnd)??(n==null?void 0:n.timeStartText)??(n==null?void 0:n.timeEndText)??(n==null?void 0:n.uploadTime)??(m==null?void 0:m.uploadTime)),hs=({logs:n,precomputedStats:m,mvpWeights:N,statsViewSettings:z,disruptionMethod:Y,includePlayerSkillMap:$})=>{const pe=Q=>{var de;return(Array.isArray((de=Q==null?void 0:Q.details)==null?void 0:de.players)?Q.details.players:[]).length>0},y=n.filter(Q=>pe(Q)),ce=z||ns,he=N||ts,Ve=Q=>{if(!Q||typeof Q!="object")return Q;const se=Array.isArray(Q.fightBreakdown)?Q.fightBreakdown:null;if(!se||se.length===0)return Q;const de=D=>Array.isArray(D)&&D.some(ue=>ue&&Number(ue.count)>0),re=new Map,Ae=new Map;n.forEach(D=>{var Se;const ue=(D==null?void 0:D.filePath)||(D==null?void 0:D.id);ue&&re.set(String(ue),D);const fe=(D==null?void 0:D.permalink)||((Se=D==null?void 0:D.details)==null?void 0:Se.permalink);typeof fe=="string"&&fe.trim()&&Ae.set(fe.trim(),D)});const Be=se.map(D=>{var qe;if(!D||typeof D!="object")return D;const ue=D.id?String(D.id):"",fe=typeof D.permalink=="string"?D.permalink.trim():"",Se=(ue?re.get(ue):void 0)||(fe?Ae.get(fe):void 0);if(!Se)return D;let De=D;if(Number(D.timestamp)<=0){const ge=Oe(Se==null?void 0:Se.details,Se);ge&&(De={...De,timestamp:ge})}const me=(qe=Se==null?void 0:Se.details)==null?void 0:qe.teamBreakdown;return de(me)&&(De={...De,teamBreakdown:me}),De}),ie=Array.isArray(Q.fightDiffMode)?Q.fightDiffMode:[],Qe=ie.some(D=>Array.isArray(D==null?void 0:D.targetFocus)&&D.targetFocus.some(ue=>Number((ue==null?void 0:ue.damage)||0)>0||Number((ue==null?void 0:ue.hits)||0)>0))?ie:Be.map((D,ue)=>{const fe=D&&typeof D.enemyClassCounts=="object"&&D.enemyClassCounts?D.enemyClassCounts:{},Se=Object.entries(fe).map(([je,Ke])=>({label:String(je||"Unknown"),count:Number(Ke||0)})).filter(je=>je.count>0).sort((je,Ke)=>Ke.count-je.count||je.label.localeCompare(Ke.label)),De=Se.reduce((je,Ke)=>je+Ke.count,0),me=Se.map(je=>({label:je.label,damage:je.count,hits:0,share:De>0?je.count/De:0})),qe=Number((D==null?void 0:D.enemyDowns)||0),ge=Number((D==null?void 0:D.enemyDeaths)||0),Ce=Number((D==null?void 0:D.alliesDown)||0),He=Number((D==null?void 0:D.alliesDead)||0),ze=Number((D==null?void 0:D.totalOutgoingDamage)||0),Ge=Number((D==null?void 0:D.totalIncomingDamage)||0),Ie=[{metricId:"winFlag",metricLabel:"Win (1) / Loss (0)",higherIsBetter:!0,value:D!=null&&D.isWin?1:0},{metricId:"squadCount",metricLabel:"Squad Size",higherIsBetter:!0,value:Number((D==null?void 0:D.squadCount)||0)},{metricId:"enemyCount",metricLabel:"Enemy Count",higherIsBetter:!1,value:Number((D==null?void 0:D.enemyCount)||0)},{metricId:"squadKdr",metricLabel:"Squad KDR",higherIsBetter:!0,value:He>0?ge/He:ge},{metricId:"enemyDeaths",metricLabel:"Enemy Deaths",higherIsBetter:!0,value:ge},{metricId:"enemyDowns",metricLabel:"Enemy Downs",higherIsBetter:!0,value:qe},{metricId:"squadDeaths",metricLabel:"Squad Deaths",higherIsBetter:!1,value:He},{metricId:"squadDowns",metricLabel:"Squad Downs",higherIsBetter:!1,value:Ce},{metricId:"damageDelta",metricLabel:"Damage Delta",higherIsBetter:!0,value:ze-Ge},{metricId:"outgoingDamage",metricLabel:"Outgoing Damage",higherIsBetter:!0,value:ze},{metricId:"incomingDamage",metricLabel:"Incoming Damage",higherIsBetter:!1,value:Ge},{metricId:"barrierIncomingAbsorb",metricLabel:"Barrier Absorption (Incoming)",higherIsBetter:!0,value:Number((D==null?void 0:D.incomingBarrierAbsorbed)||0)},{metricId:"enemyBarrierAbsorb",metricLabel:"Enemy Barrier Absorption",higherIsBetter:!1,value:Number((D==null?void 0:D.outgoingBarrierAbsorbed)||0)},{metricId:"alliesRevived",metricLabel:"Allies Revived (Players)",higherIsBetter:!0,value:Number((D==null?void 0:D.alliesRevived)||0)}];return{id:String((D==null?void 0:D.id)||`fight-${ue+1}`),shortLabel:`F${ue+1}`,fullLabel:`${String((D==null?void 0:D.mapName)||(D==null?void 0:D.label)||"Unknown Map")} • ${String((D==null?void 0:D.duration)||"--:--")}`,mapName:String((D==null?void 0:D.mapName)||""),timestamp:Number((D==null?void 0:D.timestamp)||0),duration:String((D==null?void 0:D.duration)||"--:--"),isWin:!!(D!=null&&D.isWin),targetFocus:me,squadMetrics:Ie}});return{...Q,fightBreakdown:Be,fightDiffMode:Qe}},We=(()=>{if(m)return Ve(m);const Q=Y||es,se=ce.topSkillDamageSource||"target",de=ce.topSkillsMetric||"damage",re=y.length;let Ae=0,Be=0,ie=0,Ne=0,Qe=0,D=0,ue=0,fe=0;const Se=e=>{const o=((e==null?void 0:e.players)||[]).filter(Z=>!Z.notInSquad);let M=0,r=0,U=0,C=0;return o.forEach(Z=>{var a;const G=(a=Z.defenses)==null?void 0:a[0];if(!G)return;const ne=Number(G.downCount||0),F=Number(G.deadCount||0);M+=ne+F,U+=F}),o.forEach(Z=>{!Z.statsTargets||Z.statsTargets.length===0||Z.statsTargets.forEach(G=>{const ne=G==null?void 0:G[0];if(!ne)return;const F=Number(ne.downed||0),a=Number(ne.killed||0);r+=F+a,C+=a})}),{squadDownsDeaths:M,enemyDownsDeaths:r,squadDeaths:U,enemyDeaths:C}},De=e=>{const{squadDownsDeaths:t,enemyDownsDeaths:o}=Se(e);return t>0||o>0?o>t:typeof(e==null?void 0:e.success)=="boolean"?e.success:!1},me=new Map,qe=new Set(["boonStripsTime","condiCleanseTime","condiCleanseTimeSelf"]),ge={},Ce={},He=new Map,ze={},Ge={},Ie={},je=new Map,Ke=new Map,It=new Set(Object.keys(Bt)),xt=Object.keys(Bt).filter(e=>e&&e!=="Unknown").sort((e,t)=>t.length-e.length),Lt=["Guardian","Revenant","Warrior","Engineer","Ranger","Thief","Elementalist","Mesmer","Necromancer"],tt=e=>{if(!e)return"Unknown";const t=String(e).replace(/\s*\([^)]*\)\s*$/,"").replace(/\s*\[[^\]]*\]\s*$/,"").replace(/\s\d+$/,"").trim();if(It.has(t))return t;const o=t.toLowerCase();for(const r of xt)if(o.includes(r.toLowerCase()))return r;return Lt.find(r=>o.includes(r.toLowerCase()))||t||"Unknown"},As=e=>e!=null&&e.classification?e.classification==="Boon":!0,Pt=new Map,qt=new Map,Nt=()=>({totalHits:0,blocked:0,evaded:0,glanced:0,missed:0,invulned:0,interrupted:0,totalMitigation:0,minMitigation:0}),Ee=e=>{const t=Number(e);return Number.isFinite(t)?t:0},Nn=e=>{const t=String(e).split("|"),o=t[0]||"Unknown",M=tt(t[1]||"Unknown"),r=t[2]||o||"Unknown";return{name:o,profession:M,account:r}},Sn=(e,t,o)=>{let M=e.get(t);return M?o.profession&&!M.professionList.includes(o.profession)&&M.professionList.push(o.profession):(M={account:o.account,name:o.name,profession:o.profession,professionList:o.profession?[o.profession]:[],activeMs:0,mitigationTotals:Nt()},e.set(t,M)),M},Dn=(e,t,o)=>{let M=e.get(t);return M?o.profession&&!M.professionList.includes(o.profession)&&M.professionList.push(o.profession):(M={account:o.account,name:o.name,profession:o.profession,professionList:o.profession?[o.profession]:[],activeMs:0,mitigationTotals:Nt(),minion:o.minion},e.set(t,M)),M},Cn=(e,t)=>{e.totalHits+=Ee((t==null?void 0:t.skill_hits)??(t==null?void 0:t.skillHits)),e.blocked+=Ee(t==null?void 0:t.blocked),e.evaded+=Ee(t==null?void 0:t.evaded),e.glanced+=Ee(t==null?void 0:t.glanced),e.missed+=Ee(t==null?void 0:t.missed),e.invulned+=Ee(t==null?void 0:t.invulned),e.interrupted+=Ee(t==null?void 0:t.interrupted),e.totalMitigation+=Ee((t==null?void 0:t.avoided_damage)??(t==null?void 0:t.avoidedDamage)),e.minMitigation+=Ee((t==null?void 0:t.min_avoided_damage)??(t==null?void 0:t.minAvoidedDamage))},Ms=e=>Object.values(e).some(t=>t>0),zt=new Map,ws=e=>{const t=zt.get(e);if(!t)return{hasSkill:!1,avg:1,min:1,hits:0};const o=t.connectedHits||0,M=o>0?t.totalDamage/o:0,r=t.minCount>0?t.minTotal/t.minCount:0;return{hasSkill:!0,avg:M,min:r,hits:o}},An=new Map,Mn=new Map,wn=(e,t,o)=>{const M=e.get(t)||Nt();return M.totalHits+=o.totalHits,M.blocked+=o.blocked,M.evaded+=o.evaded,M.glanced+=o.glanced,M.missed+=o.missed,M.invulned+=o.invulned,M.interrupted+=o.interrupted,e.set(t,M),M};y.forEach(e=>{const t=e.details;if(!t)return;(t.targets||[]).forEach(M=>{const r=(M==null?void 0:M.totalDamageDist)||[],U=Array.isArray(r)?r[0]:null;U==null||U.forEach(C=>{if(!(C!=null&&C.id))return;const Z=Number(C.id),G=zt.get(Z)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};G.totalDamage+=Number(C.totalDamage||0),G.connectedHits+=Number(C.connectedHits||0);const ne=Number.isFinite(Number(C.min))?Number(C.min):0;G.minTotal+=ne,G.minCount+=1,zt.set(Z,G)})})}),y.forEach(e=>{var P,q;const t=e.details;if(!t)return;const o=t.players,M=t.targets||[],r=t.combatReplayMetaData||{},U=(r==null?void 0:r.inchToPixel)>0?r.inchToPixel:1,C=(r==null?void 0:r.pollingRate)>0?r.pollingRate:1,Z=5e3,G=i=>Array.isArray(i)?i.map(u=>Array.isArray(u)?[Number(u[0]),Number(u[1])]:null).filter(u=>!!u&&Number.isFinite(u[0])):[];let ne=[],F=t.durationMS||0,a=!1;const c=o.find(i=>(i==null?void 0:i.hasCommanderTag)&&!(i!=null&&i.notInSquad));(P=c==null?void 0:c.combatReplayData)!=null&&P.positions&&(ne=c.combatReplayData.positions,G(c.combatReplayData.dead).forEach(([u])=>{u>0&&(a=!0,F=Math.min(F,u))}));const x=i=>{var p;const u=(p=i.statsAll)==null?void 0:p[0];if((u==null?void 0:u.distToCom)!==void 0&&(u==null?void 0:u.distToCom)!=="Infinity")return Math.round(Number(u.distToCom));if((u==null?void 0:u.stackDist)!==void 0)return Math.round(Number(u.stackDist))||0;if(i.hasCommanderTag)return 0;const O=i.combatReplayData;if(!(O!=null&&O.positions)||!ne.length)return 0;const J=O.positions,d=G(O.dead),s=G(O.down),ee=Math.floor((O.start||0)/C);let b=0;if(d.length&&s.length)for(const[V]of d){if(V<0)continue;const H=Math.max(0,Math.floor(V/C))-ee;for(const[R,T]of s){if(V!==T)continue;const j=a&&R>F?Math.max(1,Math.floor(F/C)):H,K=Math.max(0,Math.min(j,J.length,ne.length));if(K<=0)continue;let te=0;for(let oe=0;oe<K;oe++){const[le,ke]=J[oe],[Me,Re]=ne[oe];te+=Math.hypot(le-Me,ke-Re)}b=Math.round(te/K/U)}}return b},f=o.filter(i=>!i.notInSquad);ie+=f.length,Ne+=M.filter(i=>!i.isFake).length,yn(o,{durationMS:t.durationMS,buffMap:t.buffMap});const{squadDeaths:L,enemyDeaths:_}=Se(t);Qe+=L,D+=_,fe+=L,ue+=_,De(t)?Ae++:Be++;const g=t.skillMap?Number((q=Object.keys(t.skillMap).find(i=>{var u,O;return((O=(u=t.skillMap)==null?void 0:u[i])==null?void 0:O.name)==="Battle Standard"}))==null?void 0:q.replace(/^s/,"")):null;o.forEach((i,u)=>{var Xe,Ue,Je,ft,ut,_t,dt,mt,gt,Xt,bt,St,Rt;if(i.notInSquad)return;const O=i.account||"Unknown",J=O!=="Unknown"?O:i.name||"Unknown",d=i.name||"Unknown";me.has(J)||me.set(J,{name:d,account:J,characterNames:new Set,downContrib:0,cleanses:0,strips:0,stab:0,healing:0,barrier:0,cc:0,logsJoined:0,totalDist:0,distCount:0,dodges:0,downs:0,deaths:0,totalFightMs:0,offenseTotals:{},offenseRateWeights:{},defenseActiveMs:0,defenseTotals:{},defenseMinionDamageTaken:{},supportActiveMs:0,supportTotals:{},healingActiveMs:0,healingTotals:{},profession:i.profession||"Unknown",professions:new Set,professionTimeMs:{},squadActiveMs:0,firstSeenFightTs:0,lastSeenFightTs:0,lastSeenFightDurationMs:0,isCommander:!1,damage:0,dps:0,revives:0,outgoingConditions:{},incomingConditions:{}});const s=me.get(J);if(i.hasCommanderTag&&(s.isCommander=!0),d!=="Unknown"&&s.characterNames.add(String(d)),i.profession&&i.profession!=="Unknown"){s.profession=i.profession,s.professions.add(i.profession);const I=Array.isArray(i.activeTimes)&&typeof i.activeTimes[0]=="number"?i.activeTimes[0]:t.durationMS||0;s.professionTimeMs[i.profession]=(s.professionTimeMs[i.profession]||0)+I}s.logsJoined++,s.downContrib+=rn(i),s.cleanses+=on(i),s.strips+=an(i,Q),s.healing+=cn(i),s.barrier+=un(i),s.cc+=mn(i,Q),s.stab+=i.stabGeneration||0;const ee=x(i);ee<=Z&&(s.totalDist+=ee,s.distCount++),(Xe=i.defenses)!=null&&Xe[0]&&(s.dodges+=i.defenses[0].dodgeCount||0,s.downs+=i.defenses[0].downCount||0,s.deaths+=i.defenses[0].deadCount||0),t.durationMS&&(s.totalFightMs+=t.durationMS);const b=Array.isArray(i.activeTimes)&&typeof i.activeTimes[0]=="number"?i.activeTimes[0]:t.durationMS||0;s.squadActiveMs+=b;const p=Oe(t,e),V=Number((t==null?void 0:t.durationMS)||0);if(p>0&&((s.firstSeenFightTs<=0||p<s.firstSeenFightTs)&&(s.firstSeenFightTs=p),s.lastSeenFightTs<=0||p>s.lastSeenFightTs?(s.lastSeenFightTs=p,s.lastSeenFightDurationMs=V):p===s.lastSeenFightTs&&V>s.lastSeenFightDurationMs&&(s.lastSeenFightDurationMs=V)),s.defenseActiveMs+=b,s.supportActiveMs+=b,s.healingActiveMs+=b,Array.isArray(i.buffUptimes)&&i.buffUptimes.length>0&&i.buffUptimes.forEach(I=>{var Un,_n,Rn,$n,On,Hn;if(typeof(I==null?void 0:I.id)!="number")return;const E=`b${I.id}`,k=((Un=t.buffMap)==null?void 0:Un[E])||((_n=t.buffMap)==null?void 0:_n[String(I.id)]);if(!k||As(k))return;const w=Number((($n=(Rn=I.buffData)==null?void 0:Rn[0])==null?void 0:$n.uptime)??0),W=Number(((Hn=(On=I.buffData)==null?void 0:On[0])==null?void 0:Hn.presence)??0);if((!Number.isFinite(w)||w<=0)&&(!Number.isFinite(W)||W<=0))return;const ae=(k==null?void 0:k.stacking)??!1,Fe=(ae?Number.isFinite(w)?w:0:Number.isFinite(w)?w/100:0)*b,xe=ae?W:w,Ye=Math.min(Math.max(Number.isFinite(xe)?xe:0,0),100)/100*b,et=Number.isFinite(Fe)&&Fe>0,Dt=Number.isFinite(Ye)&&Ye>0;if(!et&&!Dt)return;const nt=is(k==null?void 0:k.name);if(nt&&us.has(nt)&&(!(k!=null&&k.classification)||k.classification==="Condition")){const $t=Fe/1e3,st=k==null?void 0:k.icon,Ct=ze[nt]||{name:nt,icon:st,applications:0,damage:0};Ct.applicationsFromUptime=(Ct.applicationsFromUptime||0)+$t,!Ct.icon&&st&&(Ct.icon=st),ze[nt]=Ct;const At=s.outgoingConditions[nt]||{applications:0,damage:0,skills:{},icon:st};At.applicationsFromUptime=(At.applicationsFromUptime||0)+$t,!At.icon&&st&&(At.icon=st),s.outgoingConditions[nt]=At;const Mt=Ge[nt]||{name:nt,icon:st,applications:0,damage:0};Mt.applicationsFromUptime=(Mt.applicationsFromUptime||0)+$t,!Mt.icon&&st&&(Mt.icon=st),Ge[nt]=Mt;const wt=s.incomingConditions[nt]||{applications:0,damage:0,skills:{},icon:st};wt.applicationsFromUptime=(wt.applicationsFromUptime||0)+$t,!wt.icon&&st&&(wt.icon=st),s.incomingConditions[nt]=wt}je.has(E)||je.set(E,{name:k==null?void 0:k.name,stacking:ae,icon:k==null?void 0:k.icon}),Ke.has(E)||Ke.set(E,new Map);const qn=Ke.get(E),Zt=s.account||i.account||i.name||"Unknown";let at=qn.get(Zt);at||(at={account:Zt,profession:s.profession||i.profession||"Unknown",professions:new Set,professionTimeMs:{},totalMs:0,uptimeMs:0,durationMs:0},qn.set(Zt,at));const pt=i.profession||s.profession;pt&&pt!=="Unknown"&&(at.professions.add(pt),at.professionTimeMs[pt]=(at.professionTimeMs[pt]||0)+b,at.profession=pt),at.totalMs+=et?Fe:0,at.uptimeMs+=Dt?Ye:0,at.durationMs+=b}),(Ue=i.defenses)!=null&&Ue[0]){const I=w=>{let W=String(w||"Unknown").replace(/^Juvenile\s+/i,"")||"Unknown";return W.toUpperCase().includes("UNKNOWN")&&(W="Unknown"),W},k=(()=>{const w=Array.isArray(i==null?void 0:i.minions)?i.minions:[];if(w.length===0)return{total:0,byMinion:{}};let W=0;const ae={};return w.forEach(be=>{const Fe=Array.isArray(be==null?void 0:be.totalDamageTakenDist)?be.totalDamageTakenDist:[],xe=Array.isArray(Fe[0])?Fe[0]:[],rt=I(be==null?void 0:be.name);xe.forEach(Ye=>{const et=Number((Ye==null?void 0:Ye.totalDamage)??(Ye==null?void 0:Ye.damageTaken)??0);Number.isFinite(et)&&(W+=et,ae[rt]=(ae[rt]||0)+et)})}),{total:W,byMinion:ae}})();k.byMinion&&typeof k.byMinion=="object"&&Object.entries(k.byMinion).forEach(([w,W])=>{const ae=Number(W||0);!Number.isFinite(ae)||ae<=0||(s.defenseMinionDamageTaken[w]=(s.defenseMinionDamageTaken[w]||0)+ae)}),ls.forEach(w=>{const W=w.id==="minionDamageTaken"?k.total:Number(i.defenses[0][w.field]??0);Number.isFinite(W)&&(s.defenseTotals[w.id]=(s.defenseTotals[w.id]||0)+W)})}(Je=i.support)!=null&&Je[0]&&fs.forEach(I=>{let E=Number(i.support[0][I.field]??0);Number.isFinite(E)&&(qe.has(I.field)&&E>999999&&(E=0),s.supportTotals[I.id]=(s.supportTotals[I.id]||0)+E)});const H=(I,E)=>{Number.isFinite(E)&&(s.healingTotals[I]=(s.healingTotals[I]||0)+E)},R=(I,E)=>Array.isArray(I)?I.reduce((k,w)=>k+Number((w==null?void 0:w[E])??0),0):0,T=(I,E,k)=>{if(!Number.isFinite(k)||k<=0)return;const w=o[E],W=E===u,ae=w==null?void 0:w.notInSquad,be=!ae,Fe=be&&(w==null?void 0:w.group)!=null&&w.group===i.group;H(I,k),be&&H(`squad${I[0].toUpperCase()}${I.slice(1)}`,k),Fe&&H(`group${I[0].toUpperCase()}${I.slice(1)}`,k),W&&H(`self${I[0].toUpperCase()}${I.slice(1)}`,k),ae&&H(`offSquad${I[0].toUpperCase()}${I.slice(1)}`,k)};if(Array.isArray(i.rotation)){let I=0;i.rotation.forEach(E=>{var w;if(!(E!=null&&E.id)||!bs(E.id,t.skillMap))return;const k=((w=E.skills)==null?void 0:w.length)||0;k>0&&(I+=k,H(`resUtility_s${E.id}`,k))}),I>0&&H("resUtility",I)}const j=(ft=i.extHealingStats)==null?void 0:ft.outgoingHealingAllies;Array.isArray(j)&&j.forEach((I,E)=>{const k=R(I,"healing"),w=R(I,"downedHealing");T("healing",E,k),T("downedHealing",E,w)});const K=(ut=i.extBarrierStats)==null?void 0:ut.outgoingBarrierAllies;Array.isArray(K)&&K.forEach((I,E)=>{const k=R(I,"barrier");T("barrier",E,k)});const te=(_t=i.statsAll)==null?void 0:_t[0],oe=(dt=i.dpsAll)==null?void 0:dt[0],le=(mt=i.support)==null?void 0:mt[0];if(ms.forEach(I=>{if(I.id==="downContributionPercent"||!I.field)return;let E=0,k=0;I.source==="dpsAll"&&oe?E=Number(oe[I.field]??0):I.source==="statsAll"&&te?(E=Number(te[I.field]??0),k=Number(te[I.denomField||I.weightField||"connectedDamageCount"]??0)):I.source==="support"&&le?E=Number(le[I.field]??0):i.statsTargets&&i.statsTargets.forEach(w=>{w!=null&&w[0]&&(E+=Number(w[0][I.field]??0),k+=Number(w[0][I.denomField||I.weightField||"connectedDamageCount"]??0))}),Number.isFinite(E)&&(s.offenseTotals[I.id]=(s.offenseTotals[I.id]||0)+E,I.isRate&&k>0&&(s.offenseRateWeights[I.id]=(s.offenseRateWeights[I.id]||0)+k))}),i.targetDamageDist&&Number.isFinite(g)){const I=i.targetDamageDist.flatMap(E=>E||[]).flatMap(E=>E||[]).reduce((E,k)=>k!=null&&k.id&&k.id===g?E+((k==null?void 0:k.connectedHits)||0):E,0);s.offenseTotals.battleStandardHits=(s.offenseTotals.battleStandardHits||0)+I}s.revives+=((Xt=(gt=i.support)==null?void 0:gt[0])==null?void 0:Xt.resurrects)||0,oe&&(s.damage+=oe.damage||0,s.dps+=oe.dps||0);const ke=I=>{var ae,be;let E=`Skill ${I.id}`;const k=((ae=t.skillMap)==null?void 0:ae[`s${I.id}`])||((be=t.skillMap)==null?void 0:be[`${I.id}`]);let w=k==null?void 0:k.icon;k!=null&&k.name&&(E=k.name);const W=lt(t.buffMap,I.id);if(E.startsWith("Skill ")&&(W!=null&&W.name)&&(E=W.name,w=W.icon||w),E.startsWith("Skill ")){const Fe=Tt(E,I.id,t.buffMap);Fe&&(E=Fe,w=(W==null?void 0:W.icon)||w)}return{name:E,icon:w}},Me=I=>{if(!(I!=null&&I.id))return;const{name:E,icon:k}=ke(I);ge[I.id]||(ge[I.id]={name:E,icon:k,damage:0,hits:0,downContribution:0}),ge[I.id].name.startsWith("Skill ")&&!E.startsWith("Skill ")&&(ge[I.id].name=E),!ge[I.id].icon&&k&&(ge[I.id].icon=k),ge[I.id].damage+=I.totalDamage,ge[I.id].hits+=I.connectedHits,ge[I.id].downContribution+=Number(I.downContribution||0)},Re=i.account||i.name||"Unknown",Te=i.profession||"Unknown",$e=`${Re}|${Te}`;let Pe=He.get($e);Pe||(Pe={key:$e,account:Re,displayName:Re,profession:Te,professionList:[Te],totalFightMs:0,skills:new Map},He.set($e,Pe)),Pe.professionList.includes(Te)||Pe.professionList.push(Te),Pe.totalFightMs+=t.durationMS||0;const ve=I=>{if(!(I!=null&&I.id))return;const{name:E,icon:k}=ke(I),w=`s${I.id}`;let W=Pe.skills.get(w);W||(W={id:w,name:E,icon:k,damage:0,downContribution:0},Pe.skills.set(w,W)),W.name.startsWith("Skill ")&&!E.startsWith("Skill ")&&(W.name=E),!W.icon&&k&&(W.icon=k),W.damage+=Number(I.totalDamage||0),W.downContribution+=Number(I.downContribution||0)};if(se==="total")(bt=i.totalDamageDist)==null||bt.forEach(I=>{I==null||I.forEach(E=>{Me(E),ve(E)})});else{const I=new Map;(St=i.targetDamageDist)==null||St.forEach(k=>{k==null||k.forEach(w=>{w==null||w.forEach(W=>{const ae=Number(W==null?void 0:W.id);if(Number.isFinite(ae)){const be=I.get(ae)||{damage:0,hits:0,downContribution:0};be.damage+=Number((W==null?void 0:W.totalDamage)||0),be.hits+=Number((W==null?void 0:W.connectedHits)||0),be.downContribution+=Number((W==null?void 0:W.downContribution)||0),I.set(ae,be)}Me(W),ve(W)})})}),!(t!=null&&t.detailedWvW)&&((Rt=i.totalDamageDist)==null||Rt.forEach(k=>{k==null||k.forEach(w=>{const W=Number(w==null?void 0:w.id);if(!Number.isFinite(W))return;const ae=I.get(W);if(!ae){Me(w),ve(w);return}const be=Number((w==null?void 0:w.totalDamage)||0),Fe=Number((w==null?void 0:w.connectedHits)||0),xe=Number((w==null?void 0:w.downContribution)||0),rt=be-Number(ae.damage||0),Ye=Fe-Number(ae.hits||0),et=xe-Number(ae.downContribution||0);if(rt<=0&&Ye<=0&&et<=0)return;const Dt={...w,totalDamage:Math.max(0,rt),connectedHits:Math.max(0,Ye),downContribution:Math.max(0,et)};Me(Dt),ve(Dt)})}))}i.totalDamageTaken&&i.totalDamageTaken.forEach(I=>{I==null||I.forEach(E=>{var be,Fe;if(!(E!=null&&E.id))return;let k=`Skill ${E.id}`;const w=((be=t.skillMap)==null?void 0:be[`s${E.id}`])||((Fe=t.skillMap)==null?void 0:Fe[`${E.id}`]);let W=w==null?void 0:w.icon;w!=null&&w.name&&(k=w.name);const ae=lt(t.buffMap,E.id);if(k.startsWith("Skill ")&&(ae!=null&&ae.name)&&(k=ae.name,W=ae.icon||W),k.startsWith("Skill ")){const xe=Tt(k,E.id,t.buffMap);xe&&(k=xe,W=(ae==null?void 0:ae.icon)||W)}Ce[E.id]||(Ce[E.id]={name:k,icon:W,damage:0,hits:0}),(!Ce[E.id].name.startsWith("Skill ")||k.startsWith("Skill "))&&(Ce[E.id].name=k),!Ce[E.id].icon&&W&&(Ce[E.id].icon=W),Ce[E.id].damage+=E.totalDamage,Ce[E.id].hits+=E.hits})})}),M.forEach(i=>{if(i!=null&&i.isFake)return;const u=tt((i==null?void 0:i.profession)||(i==null?void 0:i.name)||(i==null?void 0:i.id));u&&(Ie[u]=(Ie[u]||0)+1)});const h=cs({players:o,targets:M,skillMap:t.skillMap,buffMap:t.buffMap,getPlayerKey:i=>i.account&&i.account!=="Unknown"?i.account:i.name||null}),S=fn(t.buffMap);Object.entries(h.playerConditions).forEach(([i,u])=>{const O=me.get(i);O&&Object.entries(u).forEach(([J,d])=>{const s=O.outgoingConditions[J]||{applications:0,damage:0,skills:{},icon:d.icon};s.applications+=Number(d.applications||0),s.damage+=Number(d.damage||0),d.applicationsFromBuffs&&(s.applicationsFromBuffs=(s.applicationsFromBuffs||0)+d.applicationsFromBuffs),d.applicationsFromBuffsActive&&(s.applicationsFromBuffsActive=(s.applicationsFromBuffsActive||0)+d.applicationsFromBuffsActive),Object.entries(d.skills||{}).forEach(([ee,b])=>{const p=s.skills[ee]||{name:b.name,hits:0,damage:0,icon:b.icon};p.hits+=Number(b.hits||0),p.damage+=Number(b.damage||0),!p.icon&&b.icon&&(p.icon=b.icon),s.skills[ee]=p}),!s.icon&&d.icon&&(s.icon=d.icon),O.outgoingConditions[J]=s})}),Object.entries(h.summary).forEach(([i,u])=>{const O=ze[i]||{name:u.name||i,icon:u.icon,applications:0,damage:0};O.applications+=Number(u.applications||0),O.damage+=Number(u.damage||0),u.applicationsFromBuffs&&(O.applicationsFromBuffs=(O.applicationsFromBuffs||0)+u.applicationsFromBuffs),u.applicationsFromBuffsActive&&(O.applicationsFromBuffsActive=(O.applicationsFromBuffsActive||0)+u.applicationsFromBuffsActive),!O.icon&&u.icon&&(O.icon=u.icon),ze[i]=O}),f.forEach(i=>{const u=i.account&&i.account!=="Unknown"?i.account:i.name||"Unknown",O=me.get(u);!O||!i.totalDamageTaken||i.totalDamageTaken.forEach(J=>J==null?void 0:J.forEach(d=>{var le,ke;if(!(d!=null&&d.id))return;let s=`Skill ${d.id}`;const ee=((le=t.skillMap)==null?void 0:le[`s${d.id}`])||((ke=t.skillMap)==null?void 0:ke[`${d.id}`]);ee!=null&&ee.name&&(s=ee.name);const b=lt(t.buffMap,d.id);s.startsWith("Skill ")&&(b!=null&&b.name)&&(s=b.name);const p=Tt(s,d.id,t.buffMap);if(!p)return;const V=b==null?void 0:b.name,H=S.get(p)||(b==null?void 0:b.icon),R=(ee==null?void 0:ee.icon)||(b==null?void 0:b.icon)||H;s.startsWith("Skill ")&&(V||p)&&(s=V||p);const T=Number(d.hits??0),j=Number(d.totalDamage??0),K=Ge[p]||{name:p,icon:H,applications:0,damage:0};K.applications+=Number.isFinite(T)?T:0,K.damage+=Number.isFinite(j)?j:0,!K.icon&&H&&(K.icon=H),Ge[p]=K;const te=O.incomingConditions[p]||{applications:0,damage:0,skills:{},icon:H};te.applications+=Number.isFinite(T)?T:0,te.damage+=Number.isFinite(j)?j:0;const oe=te.skills[s]||{name:s,hits:0,damage:0,icon:R};oe.hits+=Number.isFinite(T)?T:0,oe.damage+=Number.isFinite(j)?j:0,!oe.icon&&R&&(oe.icon=R),te.skills[s]=oe,!te.icon&&H&&(te.icon=H),O.incomingConditions[p]=te}))});const B=t.player_damage_mitigation||t.playerDamageMitigation,v=B&&typeof B=="object"&&Object.keys(B).length>0;v&&Object.entries(B).forEach(([i,u])=>{if(!u||typeof u!="object")return;const O=Nn(i),J=Sn(Pt,O.account,O);Object.values(u).forEach(d=>{Ee((d==null?void 0:d.avoided_damage)??(d==null?void 0:d.avoidedDamage))<=0||Cn(J.mitigationTotals,d)})});const A=t.player_minion_damage_mitigation||t.playerMinionDamageMitigation,l=A&&typeof A=="object"&&Object.keys(A).length>0;l&&Object.entries(A).forEach(([i,u])=>{if(!u||typeof u!="object")return;const O=Nn(i);Object.entries(u).forEach(([J,d])=>{if(!d||typeof d!="object")return;const s=`${O.account}::${J}`,ee=Dn(qt,s,{...O,minion:String(J||"Unknown")});Object.values(d).forEach(b=>{Cn(ee.mitigationTotals,b)})})}),(!v||!l)&&(v||f.forEach(i=>{const u=(i==null?void 0:i.totalDamageTaken)||[];if(!Array.isArray(u)||u.length===0)return;const O=i.account||i.name||"Unknown",J={account:O,name:i.name||O,profession:tt(i.profession||"Unknown")};Sn(Pt,O,J);const d=Array.isArray(u)?u[0]:null;d==null||d.forEach(s=>{if(!(s!=null&&s.id))return;const ee=Ee(s.blocked),b=Ee(s.evaded),p=Ee(s.glance??s.glanced),V=Ee(s.missed),H=Ee(s.invulned),R=Ee(s.interrupted),T=Ee(s.hits??s.connectedHits),j=Number(s.id);wn(An,`${O}::${j}`,{totalHits:T,blocked:ee,evaded:b,glanced:p,missed:V,invulned:H,interrupted:R})})}),l||f.forEach(i=>{const u=(i==null?void 0:i.minions)||[];if(!Array.isArray(u)||u.length===0)return;const O=i.account||i.name||"Unknown",J={account:O,name:i.name||O,profession:tt(i.profession||"Unknown")};u.forEach(d=>{const s=(d==null?void 0:d.totalDamageTakenDist)||[];if(!Array.isArray(s)||s.length===0)return;let ee=String((d==null?void 0:d.name)||"Unknown").replace(/^Juvenile\s+/i,"")||"Unknown";ee.toUpperCase().includes("UNKNOWN")&&(ee="Unknown");const b=`${O}::${ee}`;Dn(qt,b,{...J,minion:ee});const p=Array.isArray(s)?s[0]:null;p==null||p.forEach(V=>{if(!(V!=null&&V.id))return;const H=Ee(V.blocked),R=Ee(V.evaded),T=Ee(V.glance??V.glanced),j=Ee(V.missed),K=Ee(V.invulned),te=Ee(V.interrupted),oe=Ee(V.hits??V.connectedHits),le=Number(V.id);wn(Mn,`${b}::${le}`,{totalHits:oe,blocked:H,evaded:R,glanced:T,missed:j,invulned:K,interrupted:te})})})}))});const Tn=(e,t)=>{const o=new Map,M=r=>{let U=o.get(r);return U||(U=Nt(),o.set(r,U)),U};t.forEach((r,U)=>{const C=U.lastIndexOf("::"),Z=C>-1?U.slice(0,C):U,G=C>-1?Number(U.slice(C+2)):Number.NaN,ne=Number.isFinite(G)?ws(G):{hasSkill:!1,avg:0,min:0,hits:0};if(!ne.hasSkill||ne.hits<=0)return;const F=ne.avg,a=ne.min,c=r.glanced*F/2+(r.blocked+r.evaded+r.missed+r.invulned+r.interrupted)*F,x=r.glanced*a/2+(r.blocked+r.evaded+r.missed+r.invulned+r.interrupted)*a;if(c<=0)return;const f=M(Z);f.totalHits+=r.totalHits,f.blocked+=r.blocked,f.evaded+=r.evaded,f.glanced+=r.glanced,f.missed+=r.missed,f.invulned+=r.invulned,f.interrupted+=r.interrupted,f.totalMitigation+=c,f.minMitigation+=x}),e.forEach((r,U)=>{const C=o.get(U)||Nt();r.mitigationTotals.totalHits=C.totalHits,r.mitigationTotals.blocked=C.blocked,r.mitigationTotals.evaded=C.evaded,r.mitigationTotals.glanced=C.glanced,r.mitigationTotals.missed=C.missed,r.mitigationTotals.invulned=C.invulned,r.mitigationTotals.interrupted=C.interrupted,r.mitigationTotals.totalMitigation=C.totalMitigation,r.mitigationTotals.minMitigation=C.minMitigation})};Tn(Pt,An),Tn(qt,Mn);const Ts=re>0?Math.round(ie/re):0,Fs=re>0?Math.round(Ne/re):0,Bs=Qe>0?(D/Qe).toFixed(2):D>0?"∞":"0.00",vs=ue>0?(fe/ue).toFixed(2):fe>0?"∞":"0.00",Fn=(e,t)=>{const M=e.filter(C=>Number.isFinite(C.value)&&(t?C.value>0:C.value>=0)).sort((C,Z)=>{const G=t?Z.value-C.value:C.value-Z.value;return G!==0?G:C.account.localeCompare(Z.account)});let r=null,U=0;return M.map((C,Z)=>((r===null||C.value!==r)&&(U=Z+1,r=C.value),{rank:U,...C}))},Vt=Array.from(me.values()).map(e=>{const t=Array.from(e.professions).filter(o=>o!=="Unknown");if(e.professionList=t,t.length>0){let o=t[0],M=e.professionTimeMs[o]||0;t.forEach(r=>{const U=e.professionTimeMs[r]||0;U>M&&(M=U,o=r)}),e.profession=o}return{key:e.account,stat:e}}),Bn=e=>{const t=me.get(e.account);if(!t){const r=e.professionList.length>0?e.professionList:e.profession?[e.profession]:[];return{...e,professionList:r}}const o=t.professionList&&t.professionList.length>0?t.professionList:Array.from(t.professions||[]).filter(r=>r&&r!=="Unknown"),M=t.profession||e.profession;return{...e,profession:M,professionList:o.length>0?o:M?[M]:[],activeMs:t.defenseActiveMs||t.totalFightMs||e.activeMs}},Es=Array.from(Pt.values()).map(Bn).filter(e=>Ms(e.mitigationTotals)).sort((e,t)=>e.account.localeCompare(t.account)),Is=Array.from(qt.values()).map(Bn).filter(e=>e.mitigationTotals.totalMitigation>0).sort((e,t)=>{const o=e.account.localeCompare(t.account);return o!==0?o:String(e.minion||"").localeCompare(String(t.minion||""))}),Ut=(e,t)=>{switch(t){case"downContrib":return e.downContrib;case"barrier":return e.barrier;case"healing":return e.healing;case"dodges":return e.dodges;case"strips":return e.strips;case"cleanses":return e.cleanses;case"cc":return e.cc;case"stability":return e.stab;case"revives":return e.revives;case"dps":return e.dps;case"damage":return e.damage;case"participation":return e.logsJoined;case"closestToTag":return!e.isCommander&&e.distCount>0?e.totalDist/e.distCount:Number.POSITIVE_INFINITY;default:return 0}},ye=(e,t)=>Fn(Vt.map(({stat:o})=>({account:o.account,profession:o.profession,professionList:o.professionList,value:Ut(o,e),count:o.logsJoined})),t),Le={downContrib:ye("downContrib",!0),barrier:ye("barrier",!0),healing:ye("healing",!0),dodges:ye("dodges",!0),strips:ye("strips",!0),cleanses:ye("cleanses",!0),cc:ye("cc",!0),stability:ye("stability",!0),revives:ye("revives",!0),participation:ye("participation",!0),dps:ye("dps",!0),damage:ye("damage",!0),closestToTag:ye("closestToTag",!1).filter(e=>Number.isFinite(e.value))},xs={downContrib:"downContrib",barrier:"barrier",healing:"healing",dodges:"dodges",strips:"strips",cleanses:"cleanses",cc:"cc",stability:"stability",closestToTag:"closestToTag"},we=e=>{const t=e==null?void 0:e[0];return{value:(t==null?void 0:t.value)??0,player:(t==null?void 0:t.account)??"-",count:(t==null?void 0:t.count)??0,profession:(t==null?void 0:t.profession)??"Unknown",professionList:(t==null?void 0:t.professionList)??[]}},ot={maxDownContrib:we([]),maxBarrier:we([]),maxHealing:we([]),maxDodges:we([]),maxStrips:we([]),maxCleanses:we([]),maxCC:we([]),maxStab:we([]),closestToTag:we([])},it={},Ls=(e,t)=>{if(t==="closestToTag")return Ut(e,t);const o=Math.max(1,(e.totalFightMs||0)/1e3);return Ut(e,t)/o};Object.values(xs).forEach(e=>{const t=e!=="closestToTag";it[e]=Fn(Vt.map(({stat:o})=>({account:o.account,profession:o.profession,professionList:o.professionList,value:Ls(o,e),count:o.logsJoined})),t)}),ot.maxDownContrib=we(it.downContrib),ot.maxBarrier=we(it.barrier),ot.maxHealing=we(it.healing),ot.maxDodges=we(it.dodges),ot.maxStrips=we(it.strips),ot.maxCleanses=we(it.cleanses),ot.maxCC=we(it.cc),ot.maxStab=we(it.stability),ot.closestToTag=we(it.closestToTag);const Ps={maxDownContrib:we(Le.downContrib),maxBarrier:we(Le.barrier),maxHealing:we(Le.healing),maxDodges:we(Le.dodges),maxStrips:we(Le.strips),maxCleanses:we(Le.cleanses),maxCC:we(Le.cc),maxStab:we(Le.stability),closestToTag:we(Le.closestToTag)};let Kt={player:"None",account:"None",score:-1,profession:"Unknown",professionList:[],color:"#64748b",topStats:[]},vn,En,In=0;if(ce!=null&&ce.showMvp){const e={"Down Contribution":"downContribution",Healing:"healing",Cleanses:"cleanses",Strips:"strips",Stability:"stability",CC:"cc",Revives:"revives","Distance to Tag":"distanceToTag",Participation:"participation",Dodging:"dodging",DPS:"dps",Damage:"damage"},t=U=>{const C=e[U];return C?Number(he[C]||0)>0:!1},o=[],M=U=>[...U||[]].filter(C=>t(C==null?void 0:C.name)).sort((C,Z)=>Z.ratio-C.ratio||C.rank-Z.rank||C.name.localeCompare(Z.name)).slice(0,3),r=U=>{var Z;if(!U)return;const C=M(U.contribs);return{...U,player:U.name,reason:((Z=C[0])==null?void 0:Z.name)||"Top Performance",topStats:C}};Vt.forEach(({stat:U})=>{let C=0;const Z=[],G=(ne,F,a,c,x=!0)=>{var L,_;if(a<=0)return;const f=((L=F[0])==null?void 0:L.value)||0;if(f&&Number.isFinite(ne)&&(x?ne>0:ne<Number.POSITIVE_INFINITY)){const X=x?ne/f:f/ne;C+=X*a;const g=((_=F.find(h=>h.account===U.account))==null?void 0:_.rank)||0;Z.push({name:c,ratio:X,val:ne.toLocaleString(),rank:g})}};G(U.downContrib,Le.downContrib,he.downContribution,"Down Contribution"),G(U.healing,Le.healing,he.healing,"Healing"),G(U.cleanses,Le.cleanses,he.cleanses,"Cleanses"),G(U.strips,Le.strips,he.strips,"Strips"),G(U.stab,Le.stability,he.stability,"Stability"),G(U.cc,Le.cc,he.cc,"CC"),G(U.revives,Le.revives,he.revives,"Revives"),G(Ut(U,"closestToTag"),Le.closestToTag,he.distanceToTag,"Distance to Tag",!1),G(U.logsJoined,Le.participation,he.participation,"Participation"),G(U.dodges,Le.dodges,he.dodging,"Dodging"),G(U.dps,Le.dps,he.dps,"DPS"),G(U.damage,Le.damage,he.damage,"Damage"),o.push({...U,score:C,contribs:Z.filter(ne=>t(ne.name))})}),o.sort((U,C)=>C.score-U.score),o[0]&&o[0].score>0&&(Kt=r(o[0])||Kt),vn=r(o[1]),En=r(o[2]),In=o.length>0?o.reduce((U,C)=>U+C.score,0)/o.length:0}const xn=Object.values(ge).sort((e,t)=>t.damage-e.damage||t.hits-e.hits||String(e.name||"").localeCompare(String(t.name||""))).slice(0,25),Ln=Object.values(ge).sort((e,t)=>t.downContribution-e.downContribution||t.hits-e.hits||String(e.name||"").localeCompare(String(t.name||""))).slice(0,25),qs=de==="downContribution"?Ln:xn,Us=Object.values(Ce).sort((e,t)=>t.damage-e.damage).slice(0,25),_s=e=>{const t=String(e).replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),o=t.match(/^(Red|Blue|Green)\s+(?:Alpine|Desert)?\s*Borderlands$/i);return o?`${o[1]} Borderlands`:t||"Unknown"},ct=(e,t)=>_s((e==null?void 0:e.zone)||(e==null?void 0:e.mapName)||(e==null?void 0:e.map)||(e==null?void 0:e.location)||(e==null?void 0:e.fightName)||(t==null?void 0:t.fightName)||(t==null?void 0:t.encounterName)||"Unknown"),Rs=(e,t)=>{const o=(t==null?void 0:t.permalink)||(e==null?void 0:e.permalink);if(typeof o=="string"&&o.trim().length>0)return o.trim();const M=e==null?void 0:e.uploadLinks;if(!Array.isArray(M))return"";for(const r of M){if(typeof r=="string"&&r.trim().length>0)return r.trim();if(r&&typeof r=="object"){const U=r.permalink||r.link||r.url||r.reportLink;if(typeof U=="string"&&U.trim().length>0)return U.trim()}}return""},$s=(e,t)=>{const o=Number((e==null?void 0:e.durationMS)||0);return o>0?Ft(o):(typeof(t==null?void 0:t.encounterDuration)=="string"?t.encounterDuration.trim():"")||"--:--"},Pn=(e,t)=>{if((Array.isArray(e==null?void 0:e.players)?e.players:[]).length>0)return De(e);if(typeof(e==null?void 0:e.success)=="boolean")return e.success;const M=t==null?void 0:t.dashboardSummary;if(M&&typeof M=="object"){if(M.isWin===!0)return!0;if(M.isWin===!1)return!1}return null},Os=(e,t)=>{var C,Z;const o=Oe((C=e.log)==null?void 0:C.details,e.log),M=Oe((Z=t.log)==null?void 0:Z.details,t.log),r=o>0,U=M>0;return r&&U&&o!==M?o-M:r!==U?r?-1:1:e.originalIndex-t.originalIndex},Gt=n.map((e,t)=>({log:e,originalIndex:t})).sort(Os),Hs=Gt.filter(({log:e})=>pe(e)),Jt={};y.forEach(e=>{const t=ct(e==null?void 0:e.details,e);Jt[t]=(Jt[t]||0)+1});const js=Object.entries(Jt).map(([e,t])=>{const o=String(e).trim(),M=/eternal battlegrounds|^ebg$/i.test(o);let r="#64748b";return M?r="#ffffff":/red/i.test(o)?r="#ef4444":/blue/i.test(o)?r="#3b82f6":/green/i.test(o)&&(r="#22c55e"),{name:e,value:t,color:r}}).sort((e,t)=>t.value-e.value),{boonTables:Ws}=Wn(y),zs=(()=>{const e=a=>String(a||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=a=>e(a).toLowerCase().split(/[^a-z0-9]+/i).map(c=>c.trim()).filter(Boolean).map(c=>c.length>3&&c.endsWith("s")?c.slice(0,-1):c),o=(a,c)=>{const x=e(a),f=e(c);if(!f)return x;if(!x)return f;const L=t(x),_=t(f),X=new Set(L),g=new Set(_),h=_.length>0&&_.every(B=>X.has(B)),S=L.length>0&&L.every(B=>g.has(B));return h||S?x:`${x} - ${f}`},M=new Map,r=(a,c)=>{if(!M.has(a))M.set(a,{id:a,name:String((c==null?void 0:c.name)||a),icon:c==null?void 0:c.icon,stacking:!!(c!=null&&c.stacking),players:new Map,fights:[]});else if(c){const x=M.get(a);(!x.name||x.name===a)&&(c!=null&&c.name)&&(x.name=String(c.name)),!x.icon&&(c!=null&&c.icon)&&(x.icon=String(c.icon)),!x.stacking&&(c!=null&&c.stacking)&&(x.stacking=!0)}return M.get(a)},U=a=>Array.isArray(a)?a.map(c=>Array.isArray(c)?[Number(c[0]),Number(c[1])]:c&&typeof c=="object"?[Number(c.time),Number(c.value)]:null).filter(c=>!!c&&Number.isFinite(c[0])&&Number.isFinite(c[1])&&c[0]>=0).sort((c,x)=>c[0]-x[0]):[],C=(a,c,x)=>{const f=a.get(c)||[];f.length<x&&(f.length=x);for(let L=0;L<x;L+=1)Number.isFinite(f[L])||(f[L]=0);return a.set(c,f),f},Z=(a,c,x,f,L)=>{if(!c||c==="__all__"||f<=0)return;const _=U(x);if(_.length===0)return;const X=C(a,c,f),g=Math.max(1,Number(L||0),f*5e3),h=A=>Math.max(0,Math.min(g,Number(A||0))),S=(A,l,P)=>{if(!Number.isFinite(P)||P<=0)return;let q=h(A);const i=h(l);if(!(i<=q))for(;q<i;){const u=Math.max(0,Math.min(f-1,Math.floor(q/5e3))),O=Math.min(i,(u+1)*5e3),J=Math.max(0,O-q);J>0&&(X[u]=Number(X[u]||0)+J*P),q=O}};let B=h(_[0][0]),v=Math.max(0,Number(_[0][1]||0));for(let A=1;A<_.length;A+=1){const[l,P]=_[A],q=h(l);S(B,q,v),B=q,v=Math.max(0,Number(P||0))}S(B,g,v)},G=(a,c,x)=>{const f=Array.from({length:x},(X,g)=>Number((a==null?void 0:a[g])||0)),L=f.reduce((X,g)=>X+Number(g||0),0);if(!Number.isFinite(c)||c<=0)return f.map(()=>0);if(!Number.isFinite(L)||L<=0){const X=c/Math.max(1,x);return f.map(()=>X)}const _=c/L;return f.map(X=>Number(X||0)*_)},ne=()=>({selfBuffs:0,groupBuffs:0,squadBuffs:0,totalBuffs:0}),F=(a,c,x)=>{const f=Math.max(0,Number(x||0));f&&(a[c]=Number(a[c]||0)+f,(c==="selfBuffs"||c==="squadBuffs")&&(a.totalBuffs=Number(a.totalBuffs||0)+f))};return y.map(a=>({log:a,ts:Oe(a==null?void 0:a.details,a)})).sort((a,c)=>a.ts-c.ts).forEach(({log:a},c)=>{const x=a==null?void 0:a.details;if(!x)return;const L=(Array.isArray(x.players)?x.players:[]).filter(u=>!(u!=null&&u.notInSquad)),_=L.length;if(_<=0)return;const X=Math.max(0,Number((x==null?void 0:x.durationMS)||0)),g=Math.max(1,Math.ceil(Math.max(1,X)/5e3)),h=x!=null&&x.buffMap&&typeof x.buffMap=="object"?x.buffMap:{},S=new Map,B=new Map;L.forEach(u=>{const O=Number((u==null?void 0:u.group)??0);B.set(O,(B.get(O)||0)+1);const d=String((u==null?void 0:u.account)||(u==null?void 0:u.name)||"Unknown");[u==null?void 0:u.name,u==null?void 0:u.display_name,u==null?void 0:u.character_name,u==null?void 0:u.account].map(s=>String(s||"").trim()).filter(Boolean).forEach(s=>S.set(s,d))});const v=e(x.fightName||a.fightName||`Fight ${c+1}`),A=ct(x,a),l=o(v,String(A||"")),P=new Map,q=new Map,i=new Map;L.forEach(u=>{const O=String((u==null?void 0:u.account)||(u==null?void 0:u.name)||"Unknown"),J=String((u==null?void 0:u.profession)||"Unknown"),d=O,s=Number((u==null?void 0:u.group)??0),ee=Math.max(1,Number(B.get(s)||1));["selfBuffs","groupBuffs","squadBuffs"].forEach(p=>{(Array.isArray(u==null?void 0:u[p])?u[p]:[]).forEach(H=>{var Xe;const R=Number(H==null?void 0:H.id);if(!Number.isFinite(R))return;const T=`b${R}`,j=h[T]||{},K=String((j==null?void 0:j.classification)||"");if(K&&K!=="Boon")return;const te=Number(((Xe=Ot(u,p,R,X,ee,_,h))==null?void 0:Xe.generationMs)||0);if(!Number.isFinite(te)||te<=0)return;const oe=r(T,j),le=oe.players.get(d)||{key:d,account:O,displayName:O,profession:J,professionList:J&&J!=="Unknown"?[J]:[],logs:0,totals:ne()};J&&J!=="Unknown"&&!le.professionList.includes(J)&&le.professionList.push(J),(!le.profession||le.profession==="Unknown")&&J&&J!=="Unknown"&&(le.profession=J);const ke=i.get(T)||new Set;ke.has(d)||(ke.add(d),le.logs+=1,i.set(T,ke)),F(le.totals,p,te),oe.players.set(d,le);const Me=oe.players.get("__all__")||{key:"__all__",account:"All",displayName:"All",profession:"All",professionList:[],logs:0,totals:ne()};F(Me.totals,p,te),oe.players.set("__all__",Me);const Re=P.get(T)||new Map,Te=Re.get(d)||ne();F(Te,p,te),Re.set(d,Te);const $e=Re.get("__all__")||ne();F($e,p,te),Re.set("__all__",$e),P.set(T,Re);const Pe=Array.isArray(u==null?void 0:u.buffUptimes)?u.buffUptimes.find(Ue=>Number(Ue==null?void 0:Ue.id)===R):null,ve=Pe!=null&&Pe.statesPerSource&&typeof Pe.statesPerSource=="object"?Pe.statesPerSource:null;if(ve){const Ue=q.get(T)||new Map;Object.entries(ve).forEach(([Je,ft])=>{const ut=S.get(String(Je||"").trim());ut&&Z(Ue,ut,ft,g,X)}),q.set(T,Ue)}})})}),P.forEach((u,O)=>{const J=M.get(O);if(!J)return;const d=q.get(O)||new Map,s={};let ee=Array.from({length:g},()=>0),b=0;u.forEach((R,T)=>{const j={selfBuffs:Number((R==null?void 0:R.selfBuffs)||0),groupBuffs:Number((R==null?void 0:R.groupBuffs)||0),squadBuffs:Number((R==null?void 0:R.squadBuffs)||0),totalBuffs:Number((R==null?void 0:R.totalBuffs)||0)},K=Math.max(0,Number(j.totalBuffs||0));if(!Number.isFinite(K)||K<=0)return;const te=d.get(T)||[],oe=G(te,K,g);s[T]={total:K,totals:j,bucketWeights5s:Array.from({length:g},(le,ke)=>Number(te[ke]||0)),buckets5s:oe},T!=="__all__"&&(K>b&&(b=K),ee=ee.map((le,ke)=>Number(le||0)+Number(oe[ke]||0)))});const p=u.get("__all__"),V=Number((p==null?void 0:p.totalBuffs)||0);if(V>0&&(s.__all__={total:V,totals:{selfBuffs:Number((p==null?void 0:p.selfBuffs)||0),groupBuffs:Number((p==null?void 0:p.groupBuffs)||0),squadBuffs:Number((p==null?void 0:p.squadBuffs)||0),totalBuffs:Number((p==null?void 0:p.totalBuffs)||0)},bucketWeights5s:Array.from({length:g},(R,T)=>Number((d.get("__all__")||[])[T]||0)),buckets5s:ee.some(R=>Number(R||0)>0)?ee:G(d.get("__all__")||[],V,g)}),Object.keys(s).length===0)return;const H=J.players.get("__all__");H&&(H.logs+=1,J.players.set("__all__",H)),J.fights.push({id:a.filePath||a.id||`fight-${c+1}`,shortLabel:`F${c+1}`,fullLabel:l,timestamp:Oe(x,a),durationMs:X,values:s,maxTotal:b})})}),Array.from(M.values()).map(a=>({id:a.id,name:a.name||a.id,icon:a.icon,stacking:a.stacking,players:Array.from(a.players.values()).sort((c,x)=>{var L,_;if(c.key==="__all__")return-1;if(x.key==="__all__")return 1;const f=Number(((L=x.totals)==null?void 0:L.totalBuffs)||0)-Number(((_=c.totals)==null?void 0:_.totalBuffs)||0);return f!==0?f:String(c.displayName||"").localeCompare(String(x.displayName||""))}),fights:[...a.fights].sort((c,x)=>c.timestamp>0&&x.timestamp>0&&c.timestamp!==x.timestamp?c.timestamp-x.timestamp:c.shortLabel.localeCompare(x.shortLabel,void 0,{numeric:!0}))})).filter(a=>a.players.length>0&&a.fights.length>0).sort((a,c)=>String(a.name||"").localeCompare(String(c.name||"")))})(),Vs=(()=>{const e=F=>String(F||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=F=>e(F).toLowerCase().split(/[^a-z0-9]+/i).map(a=>a.trim()).filter(Boolean).map(a=>a.length>3&&a.endsWith("s")?a.slice(0,-1):a),o=(F,a)=>{const c=e(F),x=e(a);if(!x)return c;if(!c)return x;const f=t(c),L=t(x),_=new Set(f),X=new Set(L),g=L.length>0&&L.every(S=>_.has(S)),h=f.length>0&&f.every(S=>X.has(S));return g||h?c:`${c} - ${x}`},M=new Map,r=(F,a)=>{if(!M.has(F))M.set(F,{id:F,name:String((a==null?void 0:a.name)||F),icon:a==null?void 0:a.icon,stacking:!!(a!=null&&a.stacking),players:new Map,fights:[]});else if(a){const c=M.get(F);(!c.name||c.name===F)&&(a!=null&&a.name)&&(c.name=String(a.name)),!c.icon&&(a!=null&&a.icon)&&(c.icon=String(a.icon)),!c.stacking&&(a!=null&&a.stacking)&&(c.stacking=!0)}return M.get(F)},U=F=>Array.isArray(F)?F.map(a=>Array.isArray(a)?[Number(a[0]),Number(a[1])]:a&&typeof a=="object"?[Number(a.time),Number(a.value)]:null).filter(a=>!!a&&Number.isFinite(a[0])&&Number.isFinite(a[1])&&a[0]>=0).sort((a,c)=>a[0]-c[0]):[],C=(F,a)=>{if(!a)return 1;const c=String(F||"").trim().toLowerCase();return 25},Z=(F,a,c)=>{const x=Number.isFinite(F)?Math.max(0,F):0;return a?Math.max(0,Math.min(c,Math.round(x))):x>0?1:0},G=(F,a,c,x)=>{const f=Array.from({length:a},()=>0);if(!F||typeof F!="object"||a<=0)return f;Object.values(F).forEach(_=>{const X=U(_);if(X.length===0)return;let g=0,h=0;for(let S=0;S<a;S+=1){const B=S*5e3;for(;g<X.length&&X[g][0]<=B;)h=Math.max(0,Number(X[g][1]||0)),g+=1;f[S]+=Math.max(0,Number(h||0))}});const L=C(x,c);return f.map(_=>Z(_,c,L))},ne=F=>{const a=F.reduce((x,f)=>x+Math.max(0,Number(f||0)),0),c=F.reduce((x,f)=>Math.max(x,Math.max(0,Number(f||0))),0);return{total:a,peak:c,buckets5s:F}};return y.map(F=>({log:F,ts:Oe(F==null?void 0:F.details,F)})).sort((F,a)=>F.ts-a.ts).forEach(({log:F},a)=>{const c=F==null?void 0:F.details;if(!c)return;const f=(Array.isArray(c.players)?c.players:[]).filter(A=>!(A!=null&&A.notInSquad));if(f.length<=0)return;const L=Math.max(0,Number((c==null?void 0:c.durationMS)||0)),_=Math.max(1,Math.ceil(Math.max(1,L)/5e3)),X=c!=null&&c.buffMap&&typeof c.buffMap=="object"?c.buffMap:{},g=e(c.fightName||F.fightName||`Fight ${a+1}`),h=ct(c,F),S=o(g,String(h||"")),B=new Map,v=new Map;f.forEach(A=>{const l=String((A==null?void 0:A.account)||(A==null?void 0:A.name)||"Unknown"),P=l,q=String((A==null?void 0:A.profession)||"Unknown");(Array.isArray(A==null?void 0:A.buffUptimes)?A.buffUptimes:[]).forEach(u=>{const O=Number(u==null?void 0:u.id);if(!Number.isFinite(O))return;const J=`b${O}`,d=X[J]||{},s=String((d==null?void 0:d.classification)||"");if(s&&s!=="Boon")return;const ee=u!=null&&u.statesPerSource&&typeof u.statesPerSource=="object"?u.statesPerSource:null;if(!ee)return;const b=G(ee,_,!!(d!=null&&d.stacking),String((d==null?void 0:d.name)||"")),p=ne(b);if(p.total<=0&&p.peak<=0)return;const V=r(J,d),H=V.players.get(P)||{key:P,account:l,displayName:l,profession:q,professionList:q&&q!=="Unknown"?[q]:[],logs:0,total:0,peak:0};q&&q!=="Unknown"&&!H.professionList.includes(q)&&H.professionList.push(q),(!H.profession||H.profession==="Unknown")&&q&&q!=="Unknown"&&(H.profession=q);const R=v.get(J)||new Set;R.has(P)||(R.add(P),H.logs+=1,v.set(J,R)),H.total+=p.total,H.peak=Math.max(H.peak,p.peak),V.players.set(P,H);const T=B.get(J)||new Map;T.set(P,p),B.set(J,T)})}),B.forEach((A,l)=>{const P=M.get(l);if(!P)return;const q={};let i=0;A.forEach((u,O)=>{q[O]={total:Number(u.total||0),peak:Number(u.peak||0),buckets5s:Array.isArray(u.buckets5s)?u.buckets5s.map(J=>Number(J||0)):[]},i=Math.max(i,Number(u.peak||0))}),Object.keys(q).length!==0&&P.fights.push({id:F.filePath||F.id||`fight-${a+1}`,shortLabel:`F${a+1}`,fullLabel:S,timestamp:Oe(c,F),durationMs:L,values:q,maxTotal:i})})}),Array.from(M.values()).map(F=>({id:F.id,name:F.name||F.id,icon:F.icon,stacking:F.stacking,players:Array.from(F.players.values()).sort((a,c)=>{const x=Number(c.peak||0)-Number(a.peak||0);if(x!==0)return x;const f=Number(c.total||0)-Number(a.total||0);return f!==0?f:String(a.displayName||"").localeCompare(String(c.displayName||""))}),fights:[...F.fights].sort((a,c)=>a.timestamp>0&&c.timestamp>0&&a.timestamp!==c.timestamp?a.timestamp-c.timestamp:a.shortLabel.localeCompare(c.shortLabel,void 0,{numeric:!0}))})).filter(F=>F.players.length>0&&F.fights.length>0).sort((F,a)=>String(F.name||"").localeCompare(String(a.name||"")))})(),Ks=Gt.map(({log:e})=>{const t=e==null?void 0:e.details,o=Array.isArray(t==null?void 0:t.players)?t.players:[],M=Array.isArray(t==null?void 0:t.targets)?t.targets:[],r=e!=null&&e.dashboardSummary&&typeof e.dashboardSummary=="object"?e.dashboardSummary:null,U=o.filter(c=>!c.notInSquad),C=M.filter(c=>!c.isFake),Z=Math.max(0,Number((r==null?void 0:r.squadCount)||0)),G=Math.max(0,Number((r==null?void 0:r.enemyCount)||0)),ne=U.length>0?U.length:Z,F=C.length>0?C.length:G,a=o.length>0?o.length:ne;return{timestamp:Oe(t,e),squadCount:ne,friendlyCount:a,enemies:F,isWin:Pn(t,e)}}).map((e,t)=>({...e,index:t+1,label:`Log ${t+1}`})),Yt={};Array.from(me.values()).forEach(e=>{e.profession&&e.profession!=="Unknown"&&(Yt[e.profession]=(Yt[e.profession]||0)+1)});const Gs=Object.entries(Yt).map(([e,t])=>({name:e,value:t,color:dn(e)})).sort((e,t)=>t.value-e.value),Qt={};Object.keys(Ie).length===0&&y.forEach(e=>{var t,o;(o=(t=e.details)==null?void 0:t.targets)==null||o.forEach(M=>{if(M.isFake)return;const r=M.profession&&M.profession!=="Unknown"?M.profession:M.name||M.id||"Unknown",U=tt(r);Qt[U]=(Qt[U]||0)+1})});const Js=Object.keys(Ie).length>0?Ie:Qt,Ys=Object.entries(Js).map(([e,t])=>({name:e,value:t,color:dn(e)})).sort((e,t)=>t.value-e.value),Qs=Gt.map(({log:e},t)=>{const o=e==null?void 0:e.details,M=Array.isArray(o==null?void 0:o.players)?o.players:[],r=M.filter(l=>!l.notInSquad),U=M.filter(l=>l.notInSquad),Z=(Array.isArray(o==null?void 0:o.targets)?o.targets:[]).filter(l=>!l.isFake),G=e!=null&&e.dashboardSummary&&typeof e.dashboardSummary=="object"?e.dashboardSummary:null,ne=r.reduce((l,P)=>{var q,i;return l+(((i=(q=P.dpsAll)==null?void 0:q[0])==null?void 0:i.damage)||0)},0),F=r.reduce((l,P)=>{var q,i;return l+(((i=(q=P.defenses)==null?void 0:q[0])==null?void 0:i.damageTaken)||0)},0),{enemyDeaths:a,enemyDownsDeaths:c}=Se(o),x=Pn(o,e),f=Oe(o,e),L=ct(o,e),_=l=>{if(!l||typeof l!="object")return;const P=l.teamID??l.teamId??l.team??l.teamColor??l.team_color;if(P!=null)return P;const q=Object.keys(l).find(i=>/^team/i.test(i));return q?l[q]:void 0},X=(l,P)=>{const q={};return l.forEach(i=>{const u=P(i),O=tt(u);O&&(q[O]=(q[O]||0)+1)}),q},g=X(r,l=>(l==null?void 0:l.profession)||(l==null?void 0:l.name)),h=X(U,l=>(l==null?void 0:l.profession)||(l==null?void 0:l.name)),S=X(Z,l=>(l==null?void 0:l.profession)||(l==null?void 0:l.name)||(l==null?void 0:l.id)),B=new Set;r.forEach(l=>{const P=_(l);P!=null&&B.add(String(P))});const v=new Map;Z.forEach(l=>{if((l==null?void 0:l.enemyPlayer)===!1)return;const P=_(l);if(P==null)return;const q=String(P);B.has(q)||v.set(q,(v.get(q)||0)+1)});const A=Array.from(v.entries()).sort((l,P)=>{const q=P[1]-l[1];return q!==0?q:l[0].localeCompare(P[0],void 0,{numeric:!0})}).slice(0,3).map(([l,P])=>({teamId:l,count:P}));return{id:e.filePath||`fight-${t}`,label:e.encounterName||`Fight ${t+1}`,permalink:Rs(o,e),timestamp:f,mapName:L,duration:$s(o,e),isWin:x,squadCount:r.length>0?r.length:Math.max(0,Number((G==null?void 0:G.squadCount)||0)),allyCount:U.length,enemyCount:Z.length>0?Z.length:Math.max(0,Number((G==null?void 0:G.enemyCount)||0)),teamBreakdown:A,alliesDown:r.reduce((l,P)=>{var q,i;return l+(((i=(q=P.defenses)==null?void 0:q[0])==null?void 0:i.downCount)||0)},0),alliesDead:r.length>0?r.reduce((l,P)=>{var q,i;return l+(((i=(q=P.defenses)==null?void 0:q[0])==null?void 0:i.deadCount)||0)},0):Math.max(0,Number((G==null?void 0:G.squadDeaths)||0)),alliesRevived:r.reduce((l,P)=>{var q,i;return Number(((i=(q=P.statsAll)==null?void 0:q[0])==null?void 0:i.saved)||0)>0?l+1:l},0),rallies:0,enemyDeaths:Z.length>0||r.length>0?a:Math.max(0,Number((G==null?void 0:G.enemyDeaths)||0)),enemyDowns:Math.max(0,c-a),totalOutgoingDamage:ne,totalIncomingDamage:F,incomingBarrierAbsorbed:r.reduce((l,P)=>{var q,i;return l+(((i=(q=P.defenses)==null?void 0:q[0])==null?void 0:i.damageBarrier)||0)},0),outgoingBarrierAbsorbed:r.reduce((l,P)=>{var u;const q=(u=P.extBarrierStats)==null?void 0:u.outgoingBarrier;if(!Array.isArray(q))return l;let i=0;return q.forEach(O=>{if(Array.isArray(O)){O.forEach(J=>{i+=Number((J==null?void 0:J.barrier)||0)});return}i+=Number((O==null?void 0:O.barrier)||0)}),l+i},0),squadClassCountsFight:g,allyClassCountsFight:h,enemyClassCounts:S}}),Xs=Hs.map(({log:e},t)=>{const o=e.details;if(!o)return null;const r=(Array.isArray(o.players)?o.players:[]).filter(b=>!b.notInSquad),U=Array.isArray(o.targets)?o.targets:[],C=Oe(o,e),Z=ct(o,e),G=Number(o.durationMS||0),{squadDownsDeaths:ne,enemyDownsDeaths:F,squadDeaths:a,enemyDeaths:c}=Se(o),x=new Map,f=(b,p,V)=>{const H=x.get(b)||{label:b,damage:0,hits:0};H.damage+=p,H.hits+=V,x.set(b,H)};if(r.forEach(b=>{(Array.isArray(b==null?void 0:b.statsTargets)?b.statsTargets:[]).forEach((V,H)=>{const R=Array.isArray(V)?V[0]:V,T=Number((R==null?void 0:R.damage)??(R==null?void 0:R.totalDmg)??(R==null?void 0:R.connectedDmg)??0),j=Number((R==null?void 0:R.connectedHits)??(R==null?void 0:R.connectedDamageCount)??(R==null?void 0:R.hits)??0);if(T<=0&&j<=0)return;const K=U[H];if(K!=null&&K.isFake)return;const te=(K==null?void 0:K.profession)||(K==null?void 0:K.name)||(K==null?void 0:K.id)||`Target ${H+1}`,oe=tt(te);f(oe||String(te),T,j)})}),x.size===0){const b=new Map,p=V=>{if(!Array.isArray(V)||V.length===0)return[];const H=V[0];if(Array.isArray(H)&&Array.isArray(H[0])){if(typeof H[0][0]=="number")return H;if(Array.isArray(H[0])&&typeof H[0][0]=="number")return V.map(R=>Array.isArray(R)?R[0]||[]:[])}return[]};r.forEach(V=>{p(V==null?void 0:V.targetDamage1S).forEach((R,T)=>{if(!Array.isArray(R)||R.length===0)return;const j=R.map(te=>Number(te)).filter(te=>Number.isFinite(te)&&te>=0);if(j.length===0)return;const K=Math.max(0,j[j.length-1]||0);K<=0||b.set(T,(b.get(T)||0)+K)})}),b.forEach((V,H)=>{if(V<=0)return;const R=U[H];if(R!=null&&R.isFake)return;const T=(R==null?void 0:R.profession)||(R==null?void 0:R.name)||(R==null?void 0:R.id)||`Target ${H+1}`,j=tt(T);f(j||String(T),V,0)})}if(x.size===0&&U.forEach((b,p)=>{if(b!=null&&b.isFake)return;const V=Array.isArray(b==null?void 0:b.totalDamageTaken)?b.totalDamageTaken:Array.isArray(b==null?void 0:b.totalDamageDist)?b.totalDamageDist:[];let H=0,R=0;if(V.forEach(K=>{H+=Number((K==null?void 0:K.totalDamage)||(K==null?void 0:K.damage)||0),R+=Number((K==null?void 0:K.connectedHits)||(K==null?void 0:K.hits)||0)}),H<=0&&Number((b==null?void 0:b.damageTaken)||0)>0&&(H=Number(b.damageTaken||0)),H<=0&&R<=0)return;const T=(b==null?void 0:b.profession)||(b==null?void 0:b.name)||(b==null?void 0:b.id)||`Target ${p+1}`,j=tt(T);f(j||String(T),H,R)}),x.size===0){const b=new Map;U.forEach((p,V)=>{if(p!=null&&p.isFake)return;const H=(p==null?void 0:p.profession)||(p==null?void 0:p.name)||(p==null?void 0:p.id)||`Target ${V+1}`,R=tt(H)||String(H);b.set(R,(b.get(R)||0)+1)}),b.forEach((p,V)=>{p>0&&f(V,p,0)})}const L=Array.from(x.values()).sort((b,p)=>p.damage-b.damage||p.hits-b.hits||b.label.localeCompare(p.label)),_=L.reduce((b,p)=>b+p.damage,0),X=L.map(b=>({label:b.label,damage:b.damage,hits:b.hits,share:_>0?b.damage/_:0})),g=U.filter(b=>!(b!=null&&b.isFake)).length,h=r.length,S=r.reduce((b,p)=>{var V,H;return b+Number(((H=(V=p==null?void 0:p.dpsAll)==null?void 0:V[0])==null?void 0:H.damage)||0)},0),B=r.reduce((b,p)=>{var V,H;return b+Number(((H=(V=p==null?void 0:p.defenses)==null?void 0:V[0])==null?void 0:H.damageTaken)||0)},0),v=r.reduce((b,p)=>{var V,H;return b+Number(((H=(V=p==null?void 0:p.defenses)==null?void 0:V[0])==null?void 0:H.damageBarrier)||0)},0),A=r.reduce((b,p)=>{var R;const V=(R=p==null?void 0:p.extBarrierStats)==null?void 0:R.outgoingBarrier;if(!Array.isArray(V))return b;let H=0;return V.forEach(T=>{Array.isArray(T)?T.forEach(j=>{H+=Number((j==null?void 0:j.barrier)||0)}):H+=Number((T==null?void 0:T.barrier)||0)}),b+H},0),l=r.reduce((b,p)=>{var V,H;return Number(((H=(V=p==null?void 0:p.statsAll)==null?void 0:V[0])==null?void 0:H.saved)||0)>0?b+1:b},0),P=r.reduce((b,p)=>b+Number(on(p)||0),0),q=r.reduce((b,p)=>b+Number(an(p)||0),0),i=r.reduce((b,p)=>b+Number((p==null?void 0:p.stabGeneration)||0),0),u=r.reduce((b,p)=>b+Number(cn(p)||0),0),O=r.reduce((b,p)=>b+Number(un(p)||0),0),J=r.reduce((b,p)=>b+Number(mn(p)||0),0),d=r.reduce((b,p)=>b+Number(rn(p)||0),0),s=a>0?c/a:c,ee=[{metricId:"winFlag",metricLabel:"Win (1) / Loss (0)",higherIsBetter:!0,value:De(o)?1:0},{metricId:"squadCount",metricLabel:"Squad Size",higherIsBetter:!0,value:h},{metricId:"enemyCount",metricLabel:"Enemy Count",higherIsBetter:!1,value:g},{metricId:"squadKdr",metricLabel:"Squad KDR",higherIsBetter:!0,value:s},{metricId:"enemyDeaths",metricLabel:"Enemy Deaths",higherIsBetter:!0,value:c},{metricId:"enemyDowns",metricLabel:"Enemy Downs",higherIsBetter:!0,value:Math.max(0,F-c)},{metricId:"squadDeaths",metricLabel:"Squad Deaths",higherIsBetter:!1,value:a},{metricId:"squadDowns",metricLabel:"Squad Downs",higherIsBetter:!1,value:Math.max(0,ne-a)},{metricId:"damageDelta",metricLabel:"Damage Delta",higherIsBetter:!0,value:S-B},{metricId:"outgoingDamage",metricLabel:"Outgoing Damage",higherIsBetter:!0,value:S},{metricId:"incomingDamage",metricLabel:"Incoming Damage",higherIsBetter:!1,value:B},{metricId:"cleanses",metricLabel:"Squad Cleanses",higherIsBetter:!0,value:P},{metricId:"strips",metricLabel:"Squad Strips",higherIsBetter:!0,value:q},{metricId:"stability",metricLabel:"Squad Stability",higherIsBetter:!0,value:i},{metricId:"healing",metricLabel:"Squad Healing",higherIsBetter:!0,value:u},{metricId:"barrierOut",metricLabel:"Squad Barrier Out",higherIsBetter:!0,value:O},{metricId:"barrierIncomingAbsorb",metricLabel:"Barrier Absorption (Incoming)",higherIsBetter:!0,value:v},{metricId:"enemyBarrierAbsorb",metricLabel:"Enemy Barrier Absorption",higherIsBetter:!1,value:A},{metricId:"cc",metricLabel:"Squad CC",higherIsBetter:!0,value:J},{metricId:"downContrib",metricLabel:"Squad Down Contribution",higherIsBetter:!0,value:d},{metricId:"alliesRevived",metricLabel:"Allies Revived (Players)",higherIsBetter:!0,value:l}];return{id:e.filePath||e.id||`fight-${t+1}`,shortLabel:`F${t+1}`,fullLabel:`${Z||e.encounterName||"Unknown Map"} • ${Ft(G)}`,mapName:Z,timestamp:C,duration:Ft(G),isWin:De(o),targetFocus:X,squadMetrics:ee}}).filter(Boolean),Zs=Array.from(me.values()).map(e=>{const t=Object.entries(e.professionTimeMs||{}).map(([o,M])=>({profession:o,timeMs:Number(M||0)})).filter(o=>o.profession&&o.profession!=="Unknown"&&o.timeMs>0).sort((o,M)=>{const r=M.timeMs-o.timeMs;return r!==0?r:o.profession.localeCompare(M.profession)});return{account:e.account||"Unknown",characterNames:Array.from(e.characterNames||[]).filter(Boolean).sort((o,M)=>o.localeCompare(M)),classTimes:t,combatTimeMs:Number(e.squadActiveMs||e.totalFightMs||0),squadTimeMs:(()=>{const o=Number(e.firstSeenFightTs||0),M=Number(e.lastSeenFightTs||0),r=Math.max(0,Number(e.lastSeenFightDurationMs||0));return o>0&&M>0?Math.max(0,M+r-o):Number(e.squadActiveMs||e.totalFightMs||0)})()}}).filter(e=>e.account&&e.account!=="Unknown").sort((e,t)=>{const o=t.squadTimeMs-e.squadTimeMs;return o!==0?o:String(e.account).localeCompare(String(t.account))}),ys=y.map(e=>e).sort((e,t)=>Oe(e.details,e)-Oe(t.details,t)).map((e,t)=>{const o=e==null?void 0:e.details,M=Array.isArray(o==null?void 0:o.players)?o.players.filter(C=>!(C!=null&&C.notInSquad)):[],r=new Map;M.forEach(C=>{const Z=Number(C==null?void 0:C.group),G=Number.isFinite(Z)&&Z>0?Z:0;r.has(G)||r.set(G,{party:G,players:[],classCounts:{}});const ne=tt((C==null?void 0:C.profession)||(C==null?void 0:C.name)||"Unknown"),F=String((C==null?void 0:C.account)||"Unknown"),a=String((C==null?void 0:C.name)||(C==null?void 0:C.character_name)||""),c=!!(C!=null&&C.hasCommanderTag),x=r.get(G);x.players.push({account:F,characterName:a,profession:ne,isCommander:c}),x.classCounts[ne]=(x.classCounts[ne]||0)+1});const U=Array.from(r.values()).map(C=>({...C,players:C.players.sort((Z,G)=>{const ne=+!!G.isCommander-+!!Z.isCommander;if(ne!==0)return ne;const F=String(Z.profession).localeCompare(String(G.profession));return F!==0?F:String(Z.account).localeCompare(String(G.account))})})).sort((C,Z)=>C.party===0&&Z.party!==0?1:Z.party===0&&C.party!==0?-1:C.party-Z.party);return{id:String((e==null?void 0:e.filePath)||(e==null?void 0:e.id)||`fight-${t+1}`),label:`F${t+1}`,timestamp:Oe(o,e),mapName:ct(o,e),duration:Ft(Number((o==null?void 0:o.durationMS)||0)),parties:U}}),ei=(e,t)=>{const o=(t==null?void 0:t.skillMap)||{},M=(t==null?void 0:t.buffMap)||{};let r=0,U=0,C="";const Z=F=>{const a=Number(F);if(!Number.isFinite(a))return String(F||"Unknown Skill");const c=(o==null?void 0:o[`s${a}`])||(o==null?void 0:o[`${a}`]);if(c!=null&&c.name)return String(c.name);const x=(M==null?void 0:M[`b${a}`])||(M==null?void 0:M[`${a}`]);return x!=null&&x.name?String(x.name):`Skill ${a}`},G=F=>{if(!F||typeof F!="object")return;const a=[Number(F.max),Number(F.maxDamage),Number(F.maxHit)].filter(f=>Number.isFinite(f)),c=a.length>0?Math.max(...a):0;c>r&&(r=c,C=Z(F.id));const x=Number(F.downContribution||0);x>U&&(U=x)};let ne=!1;return Array.isArray(e==null?void 0:e.targetDamageDist)&&e.targetDamageDist.forEach(F=>{Array.isArray(F)&&F.forEach(a=>{Array.isArray(a)&&a.forEach(c=>{ne=!0,G(c)})})}),(!ne||r<=0)&&Array.isArray(e==null?void 0:e.totalDamageDist)&&e.totalDamageDist.forEach(F=>{Array.isArray(F)&&F.forEach(a=>G(a))}),{peak:r,peakDownContribution:U,skillName:C||"Unknown Skill"}},ti=(()=>{const e=f=>String(f||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=f=>e(f).toLowerCase().split(/[^a-z0-9]+/i).map(L=>L.trim()).filter(Boolean).map(L=>L.length>3&&L.endsWith("s")?L.slice(0,-1):L),o=(f,L)=>{const _=e(f),X=e(L);if(!X)return _;if(!_)return X;const g=t(_),h=t(X),S=new Set(g),B=new Set(h),v=h.length>0&&h.every(l=>S.has(l)),A=g.length>0&&g.every(l=>B.has(l));return v||A?_:`${_} - ${X}`},M=[],r=new Map,U=f=>{const L=v=>{if(!Array.isArray(v)||v.length===0)return[];const A=[];for(let l=0;l<v.length;l+=1){const P=Number(v[l]||0),q=l>0?Number(v[l-1]||0):0;A.push(Math.max(0,P-q))}return A},_=v=>{if(!Array.isArray(v))return[];const A=v.reduce((P,q)=>Math.max(P,Array.isArray(q)?q.length:0),0);if(A<=0)return[];const l=new Array(A).fill(0);return v.forEach(P=>{if(Array.isArray(P))for(let q=0;q<A;q+=1)l[q]+=Number(P[q]||0)}),l},X=v=>Array.isArray(v)?v.map(A=>Number(A||0)):null,h=(v=>{if(!Array.isArray(v)||v.length===0)return null;const A=v[0];if(!Array.isArray(A))return null;if(Array.isArray(A[0])&&Array.isArray(A[0][0]))return _(A);if(Array.isArray(A[0])&&!Array.isArray(A[0][0])){const l=v.map(P=>X(Array.isArray(P)?P[0]:null)).filter(P=>Array.isArray(P)&&P.length>0);if(l.length>0)return _(l)}return null})(f==null?void 0:f.targetDamage1S),S=Array.isArray(f==null?void 0:f.damage1S)&&Array.isArray(f.damage1S[0])?f.damage1S[0]:null,B=h||(Array.isArray(S)?S.map(v=>Number(v||0)):[]);return L(B)},C=(f,L)=>{if(!Array.isArray(f)||f.length===0||L<=0)return 0;let _=0,X=0;for(let g=0;g<f.length;g+=1)_+=Number(f[g]||0),g>=L&&(_-=Number(f[g-L]||0)),g>=L-1&&_>X&&(X=_);return Math.max(0,X)},Z=(f,L)=>{if(!Array.isArray(f)||f.length===0||L<=0)return[];const _=[];for(let X=0;X<f.length;X+=L){const g=Math.min(X+L,f.length),h=f.slice(X,g).reduce((S,B)=>S+Number(B||0),0);_.push(h)}return _},G=(f,L)=>{let _=0,X=0;const g=new Map,h=B=>{if(!B||typeof B!="object"||B.indirectDamage)return;const v=Number(B.totalDamage||0),A=Number(B.downContribution||0);!Number.isFinite(v)&&!Number.isFinite(A)||(_+=Number.isFinite(v)?v:0,X+=Number.isFinite(A)?A:0)};return Array.isArray(f==null?void 0:f.targetDamageDist)&&f.targetDamageDist.forEach(B=>{Array.isArray(B)&&B.forEach(v=>{Array.isArray(v)&&v.forEach(A=>{const l=Number(A==null?void 0:A.id);if(Number.isFinite(l)){const P=g.get(l)||{damage:0,downContribution:0};P.damage+=Number((A==null?void 0:A.totalDamage)||0),P.downContribution+=Number((A==null?void 0:A.downContribution)||0),g.set(l,P)}h(A)})})}),!(L!=null&&L.detailedWvW)&&Array.isArray(f==null?void 0:f.totalDamageDist)&&f.totalDamageDist.forEach(B=>{Array.isArray(B)&&B.forEach(v=>{const A=Number(v==null?void 0:v.id);if(!Number.isFinite(A)){h(v);return}const l=g.get(A);if(!l){h(v);return}const P=Number((v==null?void 0:v.totalDamage)||0)-Number(l.damage||0),q=Number((v==null?void 0:v.downContribution)||0)-Number(l.downContribution||0);P<=0&&q<=0||h({...v,totalDamage:Math.max(0,P),downContribution:Math.max(0,q)})})}),{damageTotal:Math.max(0,_),downContributionTotal:Math.max(0,X)}},ne=(f,L)=>{const _=Number(f);if(!Number.isFinite(_))return{name:String(f||"Unknown Skill"),icon:void 0};const X=(L==null?void 0:L.skillMap)||{},g=(L==null?void 0:L.buffMap)||{},h=(X==null?void 0:X[`s${_}`])||(X==null?void 0:X[`${_}`]);if(h!=null&&h.name)return{name:String(h.name),icon:h==null?void 0:h.icon};const S=(g==null?void 0:g[`b${_}`])||(g==null?void 0:g[`${_}`]);return S!=null&&S.name?{name:String(S.name),icon:S==null?void 0:S.icon}:{name:`Skill ${_}`,icon:void 0}},F=f=>Array.isArray(f)?f.map(L=>Array.isArray(L)?[Number(L[0]),Number(L[1])]:L&&typeof L=="object"?[Number(L.time),Number(L.value)]:null).filter(L=>!!L&&Number.isFinite(L[0])&&L[0]>=0):[],a=(f,L,_,X,g)=>{if(!f.length||X<=0)return[];const h=Math.max(X*5e3,g||0),S=u=>u.reduce((O,J)=>J>=0&&J<=h+2e3?O+1:O,0),B=f.map(u=>Number(u||0)).filter(u=>Number.isFinite(u)&&u>=0);if(!B.length)return[];const v=[B],A=B.reduce((u,O)=>Math.max(u,O),0),l=B.reduce((u,O)=>Math.min(u,O),Number.POSITIVE_INFINITY);A>h*20&&v.push(B.map(u=>u/1e3)),A<=h*2&&l>=0&&A>0&&A<Math.max(120,X*5+10)&&v.push(B.map(u=>u*1e3));let P=B,q=0,i=-1;return v.forEach(u=>{const O=u.reduce((d,s)=>Math.min(d,s),Number.POSITIVE_INFINITY),J=new Set([0,...L,..._]);if(Number.isFinite(O)&&h>0&&O>h){const d=Math.floor(O/h)*h;J.add(d),J.add(Math.max(0,d-h))}J.forEach(d=>{const s=u.map(b=>b-d),ee=S(s);ee>i&&(i=ee,q=d,P=u)})}),P.map(u=>u-q).filter(u=>Number.isFinite(u)&&u>=0)},c=(f,L,_,X,g)=>{const h=a(f,L,_,X,g);return Array.from(new Set(h.map(S=>Math.floor(S/5e3)).filter(S=>Number.isFinite(S)&&S>=0&&S<X)))};y.map(f=>({log:f,ts:Oe(f==null?void 0:f.details,f)})).sort((f,L)=>f.ts-L.ts).forEach(({log:f},L)=>{const _=f==null?void 0:f.details;if(!_)return;const X=e(_.fightName||f.fightName||`Fight ${L+1}`),g=ct(_,f),h=o(X,String(g||"")),S={},B=Array.isArray(_.players)?_.players:[],v=B.flatMap(d=>{const s=d==null?void 0:d.combatReplayData;return Array.isArray(s)?s.map(ee=>Number(ee==null?void 0:ee.start)):[Number(s==null?void 0:s.start)]}).filter(d=>Number.isFinite(d)&&d>=0);B.forEach(d=>{if(d!=null&&d.notInSquad)return;const s=String((d==null?void 0:d.account)||(d==null?void 0:d.name)||"Unknown"),ee=String((d==null?void 0:d.character_name)||(d==null?void 0:d.display_name)||(d==null?void 0:d.name)||""),b=String((d==null?void 0:d.profession)||"Unknown"),p=`${s}|${b}`,V=ei(d,_),H=Number(V.peak||0),R=Number(V.peakDownContribution||0),T=U(d),{damageTotal:j,downContributionTotal:K}=G(d,_),te=j>0?Math.min(1,Math.max(0,K/j)):0,oe=T.map(k=>Number(k||0)*te),le=Number(C(T,1)||0),ke=Number(C(T,5)||0),Me=Number(C(T,30)||0),Re=Number(C(oe,1)||0),Te=Number(C(oe,5)||0),$e=Number(C(oe,30)||0),Pe=Math.max(0,Math.ceil(Number((_==null?void 0:_.durationMS)||0)/5e3)),ve=Math.max(0,Math.ceil(T.length/5)),Xe=Math.max(0,Math.ceil(oe.length/5)),Ue=Math.max(Pe,ve,Xe),Je=Z(T,5),ft=Z(oe,5),ut=Array.from({length:Ue},(k,w)=>Number(Je[w]||0)),_t=Array.from({length:Ue},(k,w)=>Number(ft[w]||0)),dt=new Map,mt=k=>{if(!k||typeof k!="object"||k.indirectDamage)return;const w=Number(k.totalDamage||0),W=Number(k.downContribution||0);if((!Number.isFinite(w)||w<=0)&&(!Number.isFinite(W)||W<=0))return;const ae=Number(k.connectedHits||k.hits||0),be=ne(k.id,_),Fe=be.name,xe=dt.get(Fe)||{skillName:Fe,damage:0,downContribution:0,hits:0,icon:be.icon};xe.damage+=Number.isFinite(w)?w:0,xe.downContribution+=Number.isFinite(W)?W:0,xe.hits+=Number.isFinite(ae)?ae:0,!xe.icon&&be.icon&&(xe.icon=be.icon),dt.set(Fe,xe)},gt=new Map;Array.isArray(d==null?void 0:d.targetDamageDist)&&d.targetDamageDist.forEach(k=>{Array.isArray(k)&&k.forEach(w=>{Array.isArray(w)&&w.forEach(W=>{const ae=Number(W==null?void 0:W.id),be=Number((W==null?void 0:W.totalDamage)||0),Fe=Number((W==null?void 0:W.downContribution)||0);if(Number.isFinite(ae)){const xe=gt.get(ae)||{damage:0,downContribution:0,hits:0};xe.damage+=Number.isFinite(be)?be:0,xe.downContribution+=Number.isFinite(Fe)?Fe:0,xe.hits+=Number((W==null?void 0:W.connectedHits)||(W==null?void 0:W.hits)||0),gt.set(ae,xe)}mt(W)})})}),!(_!=null&&_.detailedWvW)&&Array.isArray(d==null?void 0:d.totalDamageDist)&&d.totalDamageDist.forEach(k=>{Array.isArray(k)&&k.forEach(w=>{const W=Number(w==null?void 0:w.id);if(!Number.isFinite(W)){mt(w);return}const ae=gt.get(W);if(!ae){mt(w);return}const be=Number((w==null?void 0:w.totalDamage)||0),Fe=Number((w==null?void 0:w.downContribution)||0),xe=Number((w==null?void 0:w.connectedHits)||(w==null?void 0:w.hits)||0),rt=be-Number(ae.damage||0),Ye=Fe-Number(ae.downContribution||0),et=xe-Number(ae.hits||0);rt<=0&&Ye<=0&&et<=0||mt({...w,totalDamage:Math.max(0,rt),downContribution:Math.max(0,Ye),connectedHits:Math.max(0,et),hits:Math.max(0,et)})})});const bt=(()=>{const k=d==null?void 0:d.combatReplayData;return Array.isArray(k)?k.filter(w=>w&&typeof w=="object"):k&&typeof k=="object"?[k]:[]})(),St=bt.map(k=>Number(k==null?void 0:k.start)).filter(k=>Number.isFinite(k)&&k>=0),Rt=bt.flatMap(k=>F(k==null?void 0:k.down).map(([w])=>Number(w||0))),I=bt.flatMap(k=>F(k==null?void 0:k.dead).map(([w])=>Number(w||0)));S[p]={hit:H,burst1s:le,burst5s:ke,burst30s:Me,hitDown:R,burst1sDown:Re,burst5sDown:Te,burst30sDown:$e,skillName:V.skillName,buckets5s:ut,buckets5sDown:_t,downIndices5s:c(Rt,St,v,Ue,Number((_==null?void 0:_.durationMS)||0)),deathIndices5s:c(I,St,v,Ue,Number((_==null?void 0:_.durationMS)||0)),skillRows:Array.from(dt.values()).sort((k,w)=>w.damage-k.damage).slice(0,50)};const E=r.get(p)||{key:p,account:s,displayName:s,characterName:ee,profession:b,professionList:[b],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakHitDown:0,peak1sDown:0,peak5sDown:0,peak30sDown:0,peakFightLabel:"",peakSkillName:""};E.logs+=1,E.professionList.includes(b)||E.professionList.push(b),!E.characterName&&ee&&(E.characterName=ee),H>E.peakHit&&(E.peakHit=H,E.peakFightLabel=h,E.peakSkillName=V.skillName),le>E.peak1s&&(E.peak1s=le),ke>E.peak5s&&(E.peak5s=ke),Me>E.peak30s&&(E.peak30s=Me),R>E.peakHitDown&&(E.peakHitDown=R),Re>E.peak1sDown&&(E.peak1sDown=Re),Te>E.peak5sDown&&(E.peak5sDown=Te),$e>E.peak30sDown&&(E.peak30sDown=$e),r.set(p,E)});const A=Object.values(S).reduce((d,s)=>Math.max(d,Number((s==null?void 0:s.hit)||0)),0),l=Object.values(S).reduce((d,s)=>Math.max(d,Number((s==null?void 0:s.burst1s)||0)),0),P=Object.values(S).reduce((d,s)=>Math.max(d,Number((s==null?void 0:s.burst5s)||0)),0),q=Object.values(S).reduce((d,s)=>Math.max(d,Number((s==null?void 0:s.burst30s)||0)),0),i=Object.values(S).reduce((d,s)=>Math.max(d,Number((s==null?void 0:s.hitDown)||0)),0),u=Object.values(S).reduce((d,s)=>Math.max(d,Number((s==null?void 0:s.burst1sDown)||0)),0),O=Object.values(S).reduce((d,s)=>Math.max(d,Number((s==null?void 0:s.burst5sDown)||0)),0),J=Object.values(S).reduce((d,s)=>Math.max(d,Number((s==null?void 0:s.burst30sDown)||0)),0);M.push({id:f.filePath||f.id||`fight-${L+1}`,shortLabel:`F${L+1}`,fullLabel:h,timestamp:Oe(_,f),values:S,maxHit:A,max1s:l,max5s:P,max30s:q,maxHitDown:i,max1sDown:u,max5sDown:O,max30sDown:J})});const x=Array.from(r.values()).sort((f,L)=>L.peakHit!==f.peakHit?L.peakHit-f.peakHit:f.displayName.localeCompare(L.displayName));return{fights:M,players:x}})(),ni=(()=>{const e=g=>String(g||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=g=>e(g).toLowerCase().split(/[^a-z0-9]+/i).map(h=>h.trim()).filter(Boolean).map(h=>h.length>3&&h.endsWith("s")?h.slice(0,-1):h),o=(g,h)=>{const S=e(g),B=e(h);if(!B)return S;if(!S)return B;const v=t(S),A=t(B),l=new Set(v),P=new Set(A),q=A.length>0&&A.every(u=>l.has(u)),i=v.length>0&&v.every(u=>P.has(u));return q||i?S:`${S} - ${B}`},M=[],r=new Map,U=(g,h)=>{const S=Number(g);if(!Number.isFinite(S))return{name:String(g||"Unknown Skill"),icon:void 0};const B=(h==null?void 0:h.skillMap)||{},v=(h==null?void 0:h.buffMap)||{},A=(B==null?void 0:B[`s${S}`])||(B==null?void 0:B[`${S}`]);if(A!=null&&A.name)return{name:String(A.name),icon:A==null?void 0:A.icon};const l=(v==null?void 0:v[`b${S}`])||(v==null?void 0:v[`${S}`]);return l!=null&&l.name?{name:String(l.name),icon:l==null?void 0:l.icon}:{name:`Skill ${S}`,icon:void 0}},C=(g,h)=>{let S=0,B="";const v=A=>{if(!A||typeof A!="object"||A.indirectDamage)return;const l=[Number(A.max),Number(A.maxDamage),Number(A.maxHit)].filter(q=>Number.isFinite(q)),P=l.length>0?Math.max(...l):0;P>S&&(S=P,B=U(A.id,h).name)};return Array.isArray(g==null?void 0:g.totalDamageDist)&&g.totalDamageDist.forEach(A=>{Array.isArray(A)&&A.forEach(l=>v(l))}),Array.isArray(g==null?void 0:g.targetDamageDist)&&g.targetDamageDist.forEach(A=>{Array.isArray(A)&&A.forEach(l=>{Array.isArray(l)&&l.forEach(P=>v(P))})}),{peak:S,skillName:B||"Unknown Skill"}},Z=g=>{if(!Array.isArray(g)||g.length===0)return[];const h=[];for(let S=0;S<g.length;S+=1){const B=Number(g[S]||0),v=S>0?Number(g[S-1]||0):0;h.push(Math.max(0,B-v))}return h},G=g=>{if(!Array.isArray(g)||g.length===0)return[];const h=g.reduce((B,v)=>Math.max(B,Array.isArray(v)?v.length:0),0);if(h<=0)return[];const S=new Array(h).fill(0);return g.forEach(B=>{if(Array.isArray(B))for(let v=0;v<h;v+=1)S[v]+=Number(B[v]||0)}),S},ne=g=>{if(!Array.isArray(g)||g.length===0)return[];const h=g[0];if(typeof h=="number")return g.map(S=>Number(S||0));if(Array.isArray(h)&&h.length>0){if(typeof h[0]=="number")return h.map(S=>Number(S||0));if(Array.isArray(h[0])){const S=h.map(B=>Array.isArray(B)?B.map(v=>Number(v||0)):null).filter(B=>Array.isArray(B)&&B.length>0);if(S.length>0)return G(S)}}return[]},F=g=>{const h=ne(g==null?void 0:g.powerDamage1S),S=ne(g==null?void 0:g.damage1S),B=h.length>0?h:S;return Z(B)},a=(g,h)=>{const S=g==null?void 0:g.targetPowerDamage1S;if(!Array.isArray(S)||!Array.isArray(S[h]))return[];const B=S[h];if(!Array.isArray(B)||B.length===0)return[];if(typeof B[0]=="number")return B.map(v=>Number(v||0));if(Array.isArray(B[0])&&!Array.isArray(B[0][0]))return B[0].map(v=>Number(v||0));if(Array.isArray(B[0])&&Array.isArray(B[0][0])){const A=B[0].map(l=>Array.isArray(l)?l.map(P=>Number(P||0)):null).filter(l=>Array.isArray(l)&&l.length>0);return G(A)}return[]},c=(g,h)=>{if(!Array.isArray(g)||g.length===0||h<=0)return 0;let S=0,B=0;for(let v=0;v<g.length;v+=1)S+=Number(g[v]||0),v>=h&&(S-=Number(g[v-h]||0)),v>=h-1&&S>B&&(B=S);return Math.max(0,B)},x=(g,h)=>{if(!Array.isArray(g)||g.length===0||h<=0)return[];const S=[];for(let B=0;B<g.length;B+=h){const v=Math.min(B+h,g.length),A=g.slice(B,v).reduce((l,P)=>l+Number(P||0),0);S.push(A)}return S},f=g=>Array.isArray(g)?g.map(h=>Array.isArray(h)?[Number(h[0]),Number(h[1])]:h&&typeof h=="object"?[Number(h.time),Number(h.value)]:null).filter(h=>!!h&&Number.isFinite(h[0])&&h[0]>=0):[],L=(g,h,S,B,v)=>{if(!g.length||B<=0)return[];const A=Math.max(B*5e3,v||0),l=s=>s.reduce((ee,b)=>b>=0&&b<=A+2e3?ee+1:ee,0),P=g.map(s=>Number(s||0)).filter(s=>Number.isFinite(s)&&s>=0);if(!P.length)return[];const q=[P],i=P.reduce((s,ee)=>Math.max(s,ee),0),u=P.reduce((s,ee)=>Math.min(s,ee),Number.POSITIVE_INFINITY);i>A*20&&q.push(P.map(s=>s/1e3)),i<=A*2&&u>=0&&i>0&&i<Math.max(120,B*5+10)&&q.push(P.map(s=>s*1e3));let O=P,J=0,d=-1;return q.forEach(s=>{const ee=s.reduce((p,V)=>Math.min(p,V),Number.POSITIVE_INFINITY),b=new Set([0,...h,...S]);if(Number.isFinite(ee)&&A>0&&ee>A){const p=Math.floor(ee/A)*A;b.add(p),b.add(Math.max(0,p-A))}b.forEach(p=>{const V=s.map(R=>R-p),H=l(V);H>d&&(d=H,J=p,O=s)})}),O.map(s=>s-J).filter(s=>Number.isFinite(s)&&s>=0)},_=(g,h,S,B,v)=>{const A=L(g,h,S,B,v);return Array.from(new Set(A.map(l=>Math.floor(l/5e3)).filter(l=>Number.isFinite(l)&&l>=0&&l<B)))};y.map(g=>({log:g,ts:Oe(g==null?void 0:g.details,g)})).sort((g,h)=>g.ts-h.ts).forEach(({log:g},h)=>{const S=g==null?void 0:g.details;if(!S)return;const B=e(S.fightName||g.fightName||`Fight ${h+1}`),v=ct(S,g),A=o(B,String(v||"")),l={},q=(Array.isArray(S.players)?S.players:[]).filter(T=>!(T!=null&&T.notInSquad)),i=q.flatMap(T=>{const j=T==null?void 0:T.combatReplayData;return Array.isArray(j)?j.map(K=>Number(K==null?void 0:K.start)):[Number(j==null?void 0:j.start)]}).filter(T=>Number.isFinite(T)&&T>=0),u=q.flatMap(T=>{const j=T==null?void 0:T.combatReplayData;return(Array.isArray(j)?j:j?[j]:[]).flatMap(te=>f(te==null?void 0:te.down).map(([oe])=>Number(oe||0)))}),O=q.flatMap(T=>{const j=T==null?void 0:T.combatReplayData;return(Array.isArray(j)?j:j?[j]:[]).flatMap(te=>f(te==null?void 0:te.dead).map(([oe])=>Number(oe||0)))}),J=new Map,d=new Map,s=new Map;(Array.isArray(S.targets)?S.targets:[]).forEach((T,j)=>{if(!T||T.isFake||!T.enemyPlayer)return;const K=tt((T==null?void 0:T.profession)||(T==null?void 0:T.name)||(T==null?void 0:T.id))||"Unknown";s.set(K,(s.get(K)||0)+1);const te=d.get(K)||new Map;Array.isArray(T==null?void 0:T.totalDamageDist)&&T.totalDamageDist.forEach(Te=>{Array.isArray(Te)&&Te.forEach($e=>{if(!$e||typeof $e!="object"||$e.indirectDamage)return;const Pe=Number($e.totalDamage||0);if(!Number.isFinite(Pe)||Pe<=0)return;const ve=Number($e.connectedHits||$e.hits||0),Xe=U($e.id,S),Ue=Xe.name,Je=te.get(Ue)||{skillName:Ue,damage:0,hits:0,icon:Xe.icon};Je.damage+=Pe,Je.hits+=Number.isFinite(ve)?ve:0,!Je.icon&&Xe.icon&&(Je.icon=Xe.icon),te.set(Ue,Je)})}),d.set(K,te);const oe=G(q.map(Te=>a(Te,j))),le=oe.length>0?Z(oe):F(T),ke=C(T,S);let Me=J.get(K);Me||(Me={perSecond:[],hit:0,skillName:""},J.set(K,Me)),le.length>Me.perSecond.length&&(Me.perSecond.length=le.length);for(let Te=0;Te<le.length;Te+=1)Me.perSecond[Te]=Number(Me.perSecond[Te]||0)+Number(le[Te]||0);const Re=Number(ke.peak||0);Re>Me.hit&&(Me.hit=Re,Me.skillName=ke.skillName||"Unknown Skill")});const b=Array.from(J.values()).some(T=>Array.isArray(T.perSecond)&&T.perSecond.some(j=>Number(j||0)>0));if(J.size===0||!b){const T=G(q.map(K=>{const te=ne(K==null?void 0:K.powerDamageTaken1S);return Z(te)})),j=Array.from(s.values()).reduce((K,te)=>K+Number(te||0),0);T.length>0&&j>0&&s.forEach((K,te)=>{const oe=Number(K||0)/j,le=T.map(Me=>Number(Me||0)*oe),ke=J.get(te);J.set(te,{perSecond:le,hit:Number((ke==null?void 0:ke.hit)||0),skillName:String((ke==null?void 0:ke.skillName)||"")})})}J.forEach((T,j)=>{var Xe;const K=j,te=Number(T.hit||0),oe=Number(c(T.perSecond,1)||0),le=Number(c(T.perSecond,5)||0),ke=Number(c(T.perSecond,30)||0),Me=Math.max(0,Math.ceil(Number((S==null?void 0:S.durationMS)||0)/5e3)),Re=Math.max(0,Math.ceil(T.perSecond.length/5)),Te=Math.max(Me,Re),$e=x(T.perSecond,5),Pe=Array.from({length:Te},(Ue,Je)=>Number($e[Je]||0));l[K]={hit:te,burst1s:oe,burst5s:le,burst30s:ke,skillName:T.skillName||"Unknown Skill",buckets5s:Pe,downIndices5s:_(u,[],i,Te,Number((S==null?void 0:S.durationMS)||0)),deathIndices5s:_(O,[],i,Te,Number((S==null?void 0:S.durationMS)||0)),skillRows:Array.from(((Xe=d.get(j))==null?void 0:Xe.values())||[]).sort((Ue,Je)=>Je.damage-Ue.damage).slice(0,50)};const ve=r.get(K)||{key:K,account:j,displayName:j,characterName:"",profession:j,professionList:[j],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakFightLabel:"",peakSkillName:""};ve.logs+=1,te>ve.peakHit&&(ve.peakHit=te,ve.peakFightLabel=A,ve.peakSkillName=T.skillName||"Unknown Skill"),oe>ve.peak1s&&(ve.peak1s=oe),le>ve.peak5s&&(ve.peak5s=le),ke>ve.peak30s&&(ve.peak30s=ke),r.set(K,ve)});const p=Object.values(l).reduce((T,j)=>Math.max(T,Number((j==null?void 0:j.hit)||0)),0),V=Object.values(l).reduce((T,j)=>Math.max(T,Number((j==null?void 0:j.burst1s)||0)),0),H=Object.values(l).reduce((T,j)=>Math.max(T,Number((j==null?void 0:j.burst5s)||0)),0),R=Object.values(l).reduce((T,j)=>Math.max(T,Number((j==null?void 0:j.burst30s)||0)),0);M.push({id:g.filePath||g.id||`fight-${h+1}`,shortLabel:`F${h+1}`,fullLabel:A,timestamp:Oe(S,g),values:l,maxHit:p,max1s:V,max5s:H,max30s:R})});const X=Array.from(r.values()).sort((g,h)=>h.peakHit!==g.peakHit?h.peakHit-g.peakHit:g.displayName.localeCompare(h.displayName));return{fights:M,players:X}})(),si=Array.from(Ke.entries()).map(([e,t])=>{const o=je.get(e)||{},M=Array.from(t.values()).map(r=>{var c,x;const U=Array.from(r.professions||[]).filter(f=>f&&f!=="Unknown");let C=r.profession||"Unknown";if(U.length>0){C=U[0];let f=((c=r.professionTimeMs)==null?void 0:c[C])||0;U.forEach(L=>{var X;const _=((X=r.professionTimeMs)==null?void 0:X[L])||0;_>f&&(f=_,C=L)})}const Z=r.durationMs||0,G=r.totalMs/1e3,ne=Z>0?r.totalMs/Z:0,F=((x=me.get(r.account))==null?void 0:x.supportActiveMs)||Z,a=F>0?r.uptimeMs/F:0;return{account:r.account,profession:C,professionList:U,total:G,perSecond:ne,uptimePerSecond:a,duration:Z/1e3}}).filter(r=>r.total>0||r.perSecond>0);return{id:e,name:o.name||e,icon:o.icon,rows:M}}).filter(e=>e.rows.length>0),ii=Array.from(He.values()).map(e=>{const t=Array.from(e.skills.values()).sort((M,r)=>r.damage-M.damage);return{key:e.key,account:e.account,displayName:e.displayName,profession:e.profession,professionList:e.professionList,totalFightMs:e.totalFightMs,skills:t}}).sort((e,t)=>e.displayName.localeCompare(t.displayName));return{total:re,wins:Ae,losses:Be,avgSquadSize:Ts,avgEnemies:Fs,squadKDR:Bs,enemyKDR:vs,totalSquadKills:D,totalSquadDeaths:Qe,totalEnemyKills:fe,totalEnemyDeaths:ue,leaderboards:Le,...Ps,outgoingConditionSummary:Object.values(ze).sort((e,t)=>t.damage-e.damage),incomingConditionSummary:Object.values(Ge).sort((e,t)=>t.damage-e.damage),outgoingConditionPlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.outgoingConditions})),incomingConditionPlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.incomingConditions})),topSkills:qs,topIncomingSkills:Us,topSkillsByDamage:xn,topSkillsByDownContribution:Ln,playerSkillBreakdowns:ii,topSkillsMetric:de,mapData:js,timelineData:Ks,boonTables:Ws,boonTimeline:zs,boonUptimeTimeline:Vs,offensePlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,offenseTotals:e.offenseTotals,offenseRateWeights:e.offenseRateWeights,totalFightMs:e.totalFightMs})),defensePlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,defenseTotals:e.defenseTotals,activeMs:e.defenseActiveMs,minionDamageTakenByMinion:e.defenseMinionDamageTaken})),damageMitigationPlayers:Es,damageMitigationMinions:Is,supportPlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,supportTotals:e.supportTotals,activeMs:e.supportActiveMs})),healingPlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,healingTotals:e.healingTotals,activeMs:e.healingActiveMs})),mvp:Kt,silver:vn,bronze:En,squadClassData:Gs,enemyClassData:Ys,fightBreakdown:Qs,fightDiffMode:Xs,attendanceData:Zs,squadCompByFight:ys,spikeDamage:ti,incomingStrikeDamage:ni,specialTables:si,topStatsPerSecond:ot,topStatsLeaderboardsPerSecond:it,avgMvpScore:In}})(),_e=(()=>{const Q=new Map,se=new Map,de=[],re=new Map,Ae=new Map;y.forEach(ie=>{const Ne=ie.details;if(!Ne)return;const Qe=Ne.skillMap||{},D=Ne.fightName||"Log",ue=Oe(Ne,ie)||Date.now(),fe={id:ie.filePath||ie.id||D,label:D,timestamp:ue,skillEntries:{},playerActiveSeconds:{},durationSeconds:Ne.durationMS?Ne.durationMS/1e3:0};(Ne.players||[]).forEach(De=>{if(De.notInSquad)return;const me=De.account||De.name||"Unknown",qe=De.profession||"Unknown",ge=`${me}|${qe}`;let Ce=se.get(ge);Ce||(Ce={key:ge,account:me,displayName:me,profession:qe,professionList:[qe],logs:0,totalActiveSeconds:0,skillTotals:{}},se.set(ge,Ce)),Ce.logs++;const He=(Array.isArray(De.activeTimes)?De.activeTimes[0]:0)/1e3;Ce.totalActiveSeconds=(Ce.totalActiveSeconds||0)+He,fe.playerActiveSeconds[ge]=He,(De.rotation||[]).forEach(ze=>{var It,xt,Lt;if(!(ze!=null&&ze.id))return;const Ge=((It=ze.skills)==null?void 0:It.length)||0;if(Ge<=0)return;const Ie=`s${ze.id}`,je=((xt=Qe[Ie])==null?void 0:xt.name)||`Skill ${ze.id}`,Ke=(Lt=Qe[Ie])==null?void 0:Lt.icon;Ce.skillTotals[Ie]=(Ce.skillTotals[Ie]||0)+Ge,Q.set(Ie,(Q.get(Ie)||0)+Ge),re.set(Ie,je),Ke&&!Ae.has(Ie)&&Ae.set(Ie,Ke),fe.skillEntries[Ie]||(fe.skillEntries[Ie]={name:je,icon:Ke,players:{}}),!fe.skillEntries[Ie].icon&&Ke&&(fe.skillEntries[Ie].icon=Ke),fe.skillEntries[Ie].players[ge]=(fe.skillEntries[Ie].players[ge]||0)+Ge})}),de.push(fe)});const Be=Array.from(Q.entries()).map(([ie,Ne])=>({id:ie,name:re.get(ie)||ie,total:Ne,icon:Ae.get(ie)})).sort((ie,Ne)=>Ne.total-ie.total);return{logRecords:de,players:Array.from(se.values()),skillOptions:Be,resUtilitySkills:[]}})();return{validLogs:y,stats:We,skillUsageData:_e}},kt=(n,m)=>{const N={};return m.forEach(z=>{n&&Object.prototype.hasOwnProperty.call(n,z)&&(N[z]=n[z])}),N},gn=n=>!!(n&&n.__statsPruned===!0),bn=(n,m)=>{if(!n||typeof n!="object")return n;const N={};return Object.entries(n).forEach(([z,Y])=>{if(!Y||typeof Y!="object")return;const $={};typeof Y.name=="string"&&($.name=Y.name),typeof Y.icon=="string"&&($.icon=Y.icon),m!=null&&m.includeClassification&&typeof Y.classification=="string"&&($.classification=Y.classification),m!=null&&m.includeStacking&&(typeof Y.stacking=="boolean"?$.stacking=Y.stacking:typeof Y.stacking=="number"&&($.stacking=!!Y.stacking)),Object.keys($).length>0&&(N[z]=$)}),N},pn=n=>{var N;const m=(N=n==null?void 0:n.statsAll)==null?void 0:N[0];return!m||typeof m!="object"?!1:m.distToCom!==void 0&&m.distToCom!=="Infinity"||m.stackDist!==void 0},ks=(n,m)=>{const N=z=>{if(!z||typeof z!="object")return null;const Y=kt(z,["start","down","dead"]);return m&&Array.isArray(z.positions)&&(Y.positions=z.positions),Y};return Array.isArray(n)?n.map(z=>N(z)).filter(z=>!!z):n&&typeof n=="object"?N(n):n},hn=n=>{if(!n||typeof n!="object")return n;const m=kt(n,["players","targets","durationMS","uploadTime","timeStart","timeStartStd","timeEnd","timeEndStd","fightName","zone","mapName","map","location","permalink","uploadLinks","success","teamBreakdown","teamCounts","combatReplayMetaData","skillMap","buffMap","encounterDuration","player_damage_mitigation","player_minion_damage_mitigation","playerDamageMitigation","playerMinionDamageMitigation"]);if(m.skillMap=bn(m.skillMap,{includeClassification:!1,includeStacking:!1}),m.buffMap=bn(m.buffMap,{includeClassification:!0,includeStacking:!0}),Array.isArray(m.players)){const N=n.players,Y=N.filter($=>!($!=null&&$.notInSquad)).some($=>!($!=null&&$.hasCommanderTag)&&!pn($));m.players=N.map($=>{const pe=kt($,["name","display_name","character_name","profession","elite_spec","group","dpsAll","statsAll","dpsTargets","statsTargets","defenses","support","rotation","extHealingStats","extBarrierStats","squadBuffVolumes","selfBuffs","groupBuffs","squadBuffs","selfBuffsActive","groupBuffsActive","squadBuffsActive","buffUptimes","totalDamageDist","targetDamageDist","damage1S","targetDamage1S","powerDamageTaken1S","targetPowerDamage1S","totalDamageTaken","totalDamageTakenDist","hasCommanderTag","notInSquad","account","activeTimes","teamID","teamId","team","teamColor","team_color"]),y=Array.isArray($==null?void 0:$.minions)?$.minions:[];pe.minions=y.map(he=>kt(he,["name","totalDamageTakenDist"]));const ce=Y&&(($==null?void 0:$.hasCommanderTag)&&!($!=null&&$.notInSquad)||!($!=null&&$.notInSquad)&&!pn($));return pe.combatReplayData=ks($==null?void 0:$.combatReplayData,ce),pe})}return Array.isArray(m.targets)&&(m.targets=m.targets.map(N=>kt(N,["id","name","isFake","dpsAll","statsAll","defenses","totalHealth","healthPercentBurned","enemyPlayer","totalDamageDist","totalDamageTaken","totalDamageTakenDist","damageTaken","powerDamage1S","damage1S","profession","teamID","teamId","team","teamColor","team_color"]))),m},Ns=n=>{if(!n||typeof n!="object"||gn(n))return n;const m={...n};return n.details?m.details=hn(n.details):m.details=hn(n),m.__statsPruned=!0,m};let Ze=null,kn=0,jt=0,vt=null,Et=0,Wt=0;const Ss=n=>typeof(n==null?void 0:n.token)=="number"&&n.token!==jt,Ds=n=>{const m=n==null?void 0:n.stats;if(!m||typeof m!="object")return{spikeSkillRowsRemoved:0,incomingSkillRowsRemoved:0,playerSkillMapsRemoved:0};const N=y=>{let ce=0;return(Array.isArray(y==null?void 0:y.fights)?y.fights:[]).forEach(Ve=>{if(!Ve||typeof Ve!="object")return;const We=Ve.values;!We||typeof We!="object"||Object.values(We).forEach(_e=>{!_e||typeof _e!="object"||Array.isArray(_e.skillRows)&&(delete _e.skillRows,ce+=1)})}),ce},z=N(m.spikeDamage),Y=N(m.incomingStrikeDamage);let $=0;return(Array.isArray(m.playerSkillBreakdowns)?m.playerSkillBreakdowns:[]).forEach(y=>{!y||typeof y!="object"||y.skillMap&&typeof y.skillMap=="object"&&(delete y.skillMap,$+=1)}),{spikeSkillRowsRemoved:z,incomingSkillRowsRemoved:Y,playerSkillMapsRemoved:$}},Cs=()=>{var pe,y;if(!Ze)return;kn+=1;const n=vt;vt=null;const m=performance.now(),N=hs({...Ze,includePlayerSkillMap:!1}),z=Ds(N),Y=Math.max(0,performance.now()-m),$=N==null?void 0:N.stats;self.postMessage({type:"result",result:N,computeId:kn,logCount:Ze.logs.length,token:jt,completedAt:Date.now(),flushId:n,diagnostics:{computeMs:Y,logsInPayload:Ze.logs.length,expectedLogCount:Et,droppedLogMessages:Wt,transferStripStats:z,counts:{playerSkillBreakdowns:Array.isArray($==null?void 0:$.playerSkillBreakdowns)?$.playerSkillBreakdowns.length:0,spikeFights:Array.isArray((pe=$==null?void 0:$.spikeDamage)==null?void 0:pe.fights)?$.spikeDamage.fights.length:0,incomingStrikeFights:Array.isArray((y=$==null?void 0:$.incomingStrikeDamage)==null?void 0:y.fights)?$.incomingStrikeDamage.fights.length:0}}})};self.onmessage=n=>{var N,z,Y,$;const m=n.data;if((m==null?void 0:m.type)==="reset"){Ze={logs:[]},typeof m.token=="number"&&(jt=m.token),Et=Math.max(0,Number(m.totalLogs||0)),Wt=0,vt=null;return}if(!Ss(m)){if((m==null?void 0:m.type)==="settings"){Ze={logs:(Ze==null?void 0:Ze.logs)||[],precomputedStats:(N=m.payload)==null?void 0:N.precomputedStats,mvpWeights:(z=m.payload)==null?void 0:z.mvpWeights,statsViewSettings:(Y=m.payload)==null?void 0:Y.statsViewSettings,disruptionMethod:($=m.payload)==null?void 0:$.disruptionMethod};return}if((m==null?void 0:m.type)==="log"){if(Ze||(Ze={logs:[]}),Et>0&&Ze.logs.length>=Et){Wt+=1;return}Ze.logs.push(gn(m.payload)?m.payload:Ns(m.payload));return}(m==null?void 0:m.type)==="flush"&&(typeof m.flushId=="number"&&(vt=m.flushId),Cs())}}})();
